import{a9 as C,d as ue,h as Oe,r as _,ag as K,ab as $e,b as De,ah as Se,c as Ne,o as s,m as t,q as l,w as g,p as Q,e as o,C as Ue,D as ie,z as Te,B as Le,H as Fe,G as d,a6 as se,ai as Re,t as u,x as T,R as Pe,$ as Ye,v as qe,Y as Be,aj as Ae}from"./index-B9WM9B43.js";/* empty css                  */import{E as He}from"./el-date-picker-LQDrgT3l.js";/* empty css                       */import{a as Me,E as ze}from"./el-radio-Cy5OMmSA.js";import{E as Ke}from"./el-card-C9-IEzMj.js";import{_ as Qe}from"./index-F9iJ6oEr.js";import{E as je,a as Ge}from"./el-table-column-CfNB-tiT.js";import"./el-checkbox-CIZQMxKL.js";import{E as Je}from"./el-row-CZ85bKL9.js";import{_ as We}from"./index-CfXeGV0Q.js";import{E as Xe}from"./el-col-DjEila-N.js";import{a as Ze,E as he}from"./el-form-item-C52vg3Rn.js";import{E as xe}from"./el-input-number-CWw6lCGD.js";import"./index-C6vhygJv.js";import"./_initCloneObject-CtNQcUp4.js";import"./el-tree-FBGJd7y4.js";import"./_baseClone-DI-sfL8c.js";const et=m=>C({url:"/opentcs/transportOrder/list",method:"get",params:m}),tt=m=>C({url:"/opentcs/transportOrder/"+m,method:"get"}),lt=m=>C({url:"/opentcs/transportOrder",method:"post",data:m}),at=m=>C({url:"/opentcs/transportOrder",method:"put",data:m}),ot=m=>C({url:"/opentcs/transportOrder/"+m,method:"delete"}),nt=(m,r)=>C({url:"/opentcs/transportOrder/assign",method:"post",data:{id:m,vehicleId:r}}),rt=m=>C({url:"/opentcs/transportOrder/start/"+m,method:"post"}),dt=m=>C({url:"/opentcs/transportOrder/complete/"+m,method:"post"}),it=m=>C({url:"/opentcs/transportOrder/cancel/"+m,method:"post"}),st={class:"p-2"},ut={class:"search"},pt={class:"dialog-footer"},mt={class:"dialog-footer"},ft=ue({name:"Order"}),Tt=ue({...ft,setup(m){const{proxy:r}=Oe(),j=_([]),P=_(!1),V=_(!0),Y=_(!0),$=_([]),N=_(!0),G=_(!0),B=_(0),J=_(),A=_(),pe=_(),k=K({visible:!1,title:""}),L=K({visible:!1,title:"分配车辆"}),H=_(!1),D=_({orderId:void 0,vehicleId:void 0}),W={id:void 0,orderNo:void 0,name:void 0,vehicleId:void 0,startLocationId:void 0,targetLocationId:void 0,status:"0",priority:"1",plannedStartTime:void 0,plannedEndTime:void 0,description:void 0},me=K({form:{...W},queryParams:{pageNum:1,pageSize:10,orderNo:void 0,name:void 0,vehicleId:void 0,startLocationId:void 0,targetLocationId:void 0,status:void 0,priority:void 0},rules:{orderNo:[{required:!0,message:"订单编号不能为空",trigger:"blur"}],startLocationId:[{required:!0,message:"起始位置不能为空",trigger:"blur"}],targetLocationId:[{required:!0,message:"目标位置不能为空",trigger:"blur"}]}}),{queryParams:f,form:i,rules:fe}=$e(me),w=async()=>{V.value=!0;const n=await et(f.value);j.value=n.rows,B.value=n.total,V.value=!1},ve=()=>{M(),k.visible=!1},M=()=>{var n;i.value={...W},(n=A.value)==null||n.resetFields()},q=()=>{f.value.pageNum=1,w()},ce=()=>{var n;(n=J.value)==null||n.resetFields(),q()},ge=n=>{$.value=n.map(e=>e.id),N.value=n.length!=1,G.value=!n.length},be=()=>{M(),k.visible=!0,k.title="添加运输订单"},X=async n=>{M();const e=(n==null?void 0:n.id)||$.value[0],b=await tt(e);Object.assign(i.value,b.data),k.visible=!0,k.title="修改运输订单"},ye=()=>{var n;(n=A.value)==null||n.validate(async e=>{e&&(P.value=!0,i.value.id?await at(i.value).finally(()=>P.value=!1):await lt(i.value).finally(()=>P.value=!1),r==null||r.$modal.msgSuccess("操作成功"),k.visible=!1,await w())})},Z=async n=>{const e=(n==null?void 0:n.id)||$.value;await(r==null?void 0:r.$modal.confirm('是否确认删除运输订单编号为"'+e+'"的数据项？').finally(()=>V.value=!1)),await ot(e),r==null||r.$modal.msgSuccess("删除成功"),await w()},h=n=>{const e=(n==null?void 0:n.id)||$.value[0];D.value={orderId:e,vehicleId:void 0},L.visible=!0},_e=async()=>{if(!D.value.vehicleId){r==null||r.$modal.msgError("请选择车辆");return}H.value=!0;try{await nt(D.value.orderId,D.value.vehicleId),r==null||r.$modal.msgSuccess("分配成功"),L.visible=!1,await w()}finally{H.value=!1}},x=async n=>{const e=(n==null?void 0:n.id)||$.value[0];try{await(r==null?void 0:r.$modal.confirm("确认要开始运输该订单吗？")),V.value=!0,await rt(e),r==null||r.$modal.msgSuccess("开始运输成功"),await w()}catch(b){console.error("开始运输失败:",b)}finally{V.value=!1}},ee=async n=>{const e=(n==null?void 0:n.id)||$.value[0];try{await(r==null?void 0:r.$modal.confirm("确认要完成该订单吗？")),V.value=!0,await dt(e),r==null||r.$modal.msgSuccess("完成订单成功"),await w()}catch(b){console.error("完成订单失败:",b)}finally{V.value=!1}},te=async n=>{const e=(n==null?void 0:n.id)||$.value[0];try{await(r==null?void 0:r.$modal.confirm("确认要取消该订单吗？")),V.value=!0,await it(e),r==null||r.$modal.msgSuccess("取消订单成功"),await w()}catch(b){console.error("取消订单失败:",b)}finally{V.value=!1}};return De(()=>{w()}),(n,e)=>{var re,de;const b=Ue,v=he,F=xe,I=Le,le=Te,p=Fe,z=Ze,S=Xe,Ve=We,we=Je,c=Ge,E=Pe,U=Ye,ke=je,Ce=Qe,Ie=Ke,O=ze,ae=Me,oe=He,ne=Ae,y=Se("hasPermi"),Ee=qe;return s(),Ne("div",st,[t(Re,{"enter-active-class":(re=o(r))==null?void 0:re.animate.searchAnimate.enter,"leave-active-class":(de=o(r))==null?void 0:de.animate.searchAnimate.leave},{default:l(()=>[g(Q("div",ut,[t(z,{ref_key:"queryFormRef",ref:J,model:o(f),inline:!0,"label-width":"100px"},{default:l(()=>[t(v,{label:"订单编号",prop:"orderNo"},{default:l(()=>[t(b,{modelValue:o(f).orderNo,"onUpdate:modelValue":e[0]||(e[0]=a=>o(f).orderNo=a),placeholder:"请输入订单编号",clearable:"",onKeyup:ie(q,["enter"])},null,8,["modelValue"])]),_:1}),t(v,{label:"订单名称",prop:"name"},{default:l(()=>[t(b,{modelValue:o(f).name,"onUpdate:modelValue":e[1]||(e[1]=a=>o(f).name=a),placeholder:"请输入订单名称",clearable:"",onKeyup:ie(q,["enter"])},null,8,["modelValue"])]),_:1}),t(v,{label:"车辆",prop:"vehicleId"},{default:l(()=>[t(F,{modelValue:o(f).vehicleId,"onUpdate:modelValue":e[2]||(e[2]=a=>o(f).vehicleId=a),placeholder:"请输入车辆ID",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(v,{label:"订单状态",prop:"status"},{default:l(()=>[t(le,{modelValue:o(f).status,"onUpdate:modelValue":e[3]||(e[3]=a=>o(f).status=a),placeholder:"订单状态",clearable:""},{default:l(()=>[t(I,{label:"待分配",value:"0"}),t(I,{label:"已分配",value:"1"}),t(I,{label:"运输中",value:"2"}),t(I,{label:"已完成",value:"3"}),t(I,{label:"已取消",value:"4"})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"优先级",prop:"priority"},{default:l(()=>[t(le,{modelValue:o(f).priority,"onUpdate:modelValue":e[4]||(e[4]=a=>o(f).priority=a),placeholder:"优先级",clearable:""},{default:l(()=>[t(I,{label:"低",value:"0"}),t(I,{label:"中",value:"1"}),t(I,{label:"高",value:"2"})]),_:1},8,["modelValue"])]),_:1}),t(v,null,{default:l(()=>[t(p,{type:"primary",icon:"Search",onClick:q},{default:l(()=>e[28]||(e[28]=[d("搜索")])),_:1}),t(p,{icon:"Refresh",onClick:ce},{default:l(()=>e[29]||(e[29]=[d("重置")])),_:1})]),_:1})]),_:1},8,["model"])],512),[[se,o(Y)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(Ie,{shadow:"never"},{header:l(()=>[t(we,{gutter:10,class:"mb8"},{default:l(()=>[t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"primary",plain:"",icon:"Plus",onClick:be},{default:l(()=>e[30]||(e[30]=[d("新增")])),_:1})),[[y,["opentcs:transportOrder:add"]]])]),_:1}),t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"success",plain:"",icon:"Edit",disabled:o(N),onClick:e[5]||(e[5]=a=>X())},{default:l(()=>e[31]||(e[31]=[d(" 修改 ")])),_:1},8,["disabled"])),[[y,["opentcs:transportOrder:edit"]]])]),_:1}),t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"danger",plain:"",icon:"Delete",disabled:o(G),onClick:e[6]||(e[6]=a=>Z())},{default:l(()=>e[32]||(e[32]=[d(" 删除 ")])),_:1},8,["disabled"])),[[y,["opentcs:transportOrder:remove"]]])]),_:1}),t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"warning",plain:"",icon:"Connection",disabled:o(N),onClick:e[7]||(e[7]=a=>h())},{default:l(()=>e[33]||(e[33]=[d(" 分配车辆 ")])),_:1},8,["disabled"])),[[y,["opentcs:transportOrder:assign"]]])]),_:1}),t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"info",plain:"",icon:"VideoPlay",disabled:o(N),onClick:e[8]||(e[8]=a=>x())},{default:l(()=>e[34]||(e[34]=[d(" 开始运输 ")])),_:1},8,["disabled"])),[[y,["opentcs:transportOrder:start"]]])]),_:1}),t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"success",plain:"",icon:"Check",disabled:o(N),onClick:e[9]||(e[9]=a=>ee())},{default:l(()=>e[35]||(e[35]=[d(" 完成订单 ")])),_:1},8,["disabled"])),[[y,["opentcs:transportOrder:complete"]]])]),_:1}),t(S,{span:1.5},{default:l(()=>[g((s(),u(p,{type:"danger",plain:"",icon:"Close",disabled:o(N),onClick:e[10]||(e[10]=a=>te())},{default:l(()=>e[36]||(e[36]=[d(" 取消订单 ")])),_:1},8,["disabled"])),[[y,["opentcs:transportOrder:cancel"]]])]),_:1}),t(Ve,{"show-search":o(Y),"onUpdate:showSearch":e[11]||(e[11]=a=>Be(Y)?Y.value=a:null),onQueryTable:w},null,8,["show-search"])]),_:1})]),default:l(()=>[g((s(),u(ke,{data:o(j),border:"",onSelectionChange:ge},{default:l(()=>[t(c,{type:"selection",width:"55",align:"center"}),t(c,{label:"id",align:"center",prop:"id"}),t(c,{label:"订单编号",align:"center",prop:"orderNo",width:"180"}),t(c,{label:"订单名称",align:"center",prop:"name"}),t(c,{label:"车辆",align:"center",prop:"vehicleName"}),t(c,{label:"起始位置",align:"center",prop:"startLocationName"}),t(c,{label:"目标位置",align:"center",prop:"targetLocationName"}),t(c,{label:"订单状态",align:"center",prop:"status",width:"100"},{default:l(a=>[a.row.status==="0"?(s(),u(E,{key:0,type:"info"},{default:l(()=>e[37]||(e[37]=[d("待分配")])),_:1})):a.row.status==="1"?(s(),u(E,{key:1,type:"warning"},{default:l(()=>e[38]||(e[38]=[d("已分配")])),_:1})):a.row.status==="2"?(s(),u(E,{key:2,type:"primary"},{default:l(()=>e[39]||(e[39]=[d("运输中")])),_:1})):a.row.status==="3"?(s(),u(E,{key:3,type:"success"},{default:l(()=>e[40]||(e[40]=[d("已完成")])),_:1})):a.row.status==="4"?(s(),u(E,{key:4,type:"danger"},{default:l(()=>e[41]||(e[41]=[d("已取消")])),_:1})):T("",!0)]),_:1}),t(c,{label:"优先级",align:"center",prop:"priority",width:"80"},{default:l(a=>[a.row.priority==="0"?(s(),u(E,{key:0,type:"info"},{default:l(()=>e[42]||(e[42]=[d("低")])),_:1})):a.row.priority==="1"?(s(),u(E,{key:1,type:"warning"},{default:l(()=>e[43]||(e[43]=[d("中")])),_:1})):a.row.priority==="2"?(s(),u(E,{key:2,type:"danger"},{default:l(()=>e[44]||(e[44]=[d("高")])),_:1})):T("",!0)]),_:1}),t(c,{label:"预计开始时间",align:"center",prop:"plannedStartTime",width:"180"}),t(c,{label:"预计完成时间",align:"center",prop:"plannedEndTime",width:"180"}),t(c,{label:"实际开始时间",align:"center",prop:"actualStartTime",width:"180"}),t(c,{label:"实际完成时间",align:"center",prop:"actualEndTime",width:"180"}),t(c,{label:"描述",align:"center",prop:"description","show-overflow-tooltip":""}),t(c,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),t(c,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"200"},{default:l(a=>[t(U,{content:"修改",placement:"top"},{default:l(()=>[g(t(p,{link:"",type:"primary",icon:"Edit",onClick:R=>X(a.row)},null,8,["onClick"]),[[y,["opentcs:transportOrder:edit"]]])]),_:2},1024),t(U,{content:"删除",placement:"top"},{default:l(()=>[g(t(p,{link:"",type:"primary",icon:"Delete",onClick:R=>Z(a.row)},null,8,["onClick"]),[[y,["opentcs:transportOrder:remove"]]])]),_:2},1024),a.row.status==="0"?(s(),u(U,{key:0,content:"分配车辆",placement:"top"},{default:l(()=>[g(t(p,{link:"",type:"warning",icon:"Connection",onClick:R=>h(a.row)},null,8,["onClick"]),[[y,["opentcs:transportOrder:assign"]]])]),_:2},1024)):T("",!0),a.row.status==="1"?(s(),u(U,{key:1,content:"开始运输",placement:"top"},{default:l(()=>[g(t(p,{link:"",type:"info",icon:"VideoPlay",onClick:R=>x(a.row)},null,8,["onClick"]),[[y,["opentcs:transportOrder:start"]]])]),_:2},1024)):T("",!0),a.row.status==="2"?(s(),u(U,{key:2,content:"完成订单",placement:"top"},{default:l(()=>[g(t(p,{link:"",type:"success",icon:"Check",onClick:R=>ee(a.row)},null,8,["onClick"]),[[y,["opentcs:transportOrder:complete"]]])]),_:2},1024)):T("",!0),["0","1","2"].includes(a.row.status)?(s(),u(U,{key:3,content:"取消订单",placement:"top"},{default:l(()=>[g(t(p,{link:"",type:"danger",icon:"Close",onClick:R=>te(a.row)},null,8,["onClick"]),[[y,["opentcs:transportOrder:cancel"]]])]),_:2},1024)):T("",!0)]),_:1})]),_:1},8,["data"])),[[Ee,o(V)]]),g(t(Ce,{page:o(f).pageNum,"onUpdate:page":e[12]||(e[12]=a=>o(f).pageNum=a),limit:o(f).pageSize,"onUpdate:limit":e[13]||(e[13]=a=>o(f).pageSize=a),total:o(B),onPagination:w},null,8,["page","limit","total"]),[[se,o(B)>0]])]),_:1}),t(ne,{modelValue:o(k).visible,"onUpdate:modelValue":e[24]||(e[24]=a=>o(k).visible=a),title:o(k).title,width:"600px","append-to-body":""},{footer:l(()=>[Q("div",pt,[t(p,{loading:o(P),type:"primary",onClick:ye},{default:l(()=>e[53]||(e[53]=[d("确 定")])),_:1},8,["loading"]),t(p,{onClick:ve},{default:l(()=>e[54]||(e[54]=[d("取 消")])),_:1})])]),default:l(()=>[t(z,{ref_key:"orderFormRef",ref:A,model:o(i),rules:o(fe),"label-width":"120px"},{default:l(()=>[t(v,{label:"订单编号",prop:"orderNo"},{default:l(()=>[t(b,{modelValue:o(i).orderNo,"onUpdate:modelValue":e[14]||(e[14]=a=>o(i).orderNo=a),placeholder:"请输入订单编号",disabled:!!o(i).id},null,8,["modelValue","disabled"])]),_:1}),t(v,{label:"订单名称",prop:"name"},{default:l(()=>[t(b,{modelValue:o(i).name,"onUpdate:modelValue":e[15]||(e[15]=a=>o(i).name=a),placeholder:"请输入订单名称"},null,8,["modelValue"])]),_:1}),t(v,{label:"车辆ID",prop:"vehicleId"},{default:l(()=>[t(F,{modelValue:o(i).vehicleId,"onUpdate:modelValue":e[16]||(e[16]=a=>o(i).vehicleId=a),placeholder:"请输入车辆ID",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"起始位置ID",prop:"startLocationId"},{default:l(()=>[t(F,{modelValue:o(i).startLocationId,"onUpdate:modelValue":e[17]||(e[17]=a=>o(i).startLocationId=a),placeholder:"请输入起始位置ID",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"目标位置ID",prop:"targetLocationId"},{default:l(()=>[t(F,{modelValue:o(i).targetLocationId,"onUpdate:modelValue":e[18]||(e[18]=a=>o(i).targetLocationId=a),placeholder:"请输入目标位置ID",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"订单状态",prop:"status"},{default:l(()=>[t(ae,{modelValue:o(i).status,"onUpdate:modelValue":e[19]||(e[19]=a=>o(i).status=a)},{default:l(()=>[t(O,{value:"0"},{default:l(()=>e[45]||(e[45]=[d("待分配")])),_:1}),t(O,{value:"1"},{default:l(()=>e[46]||(e[46]=[d("已分配")])),_:1}),t(O,{value:"2"},{default:l(()=>e[47]||(e[47]=[d("运输中")])),_:1}),t(O,{value:"3"},{default:l(()=>e[48]||(e[48]=[d("已完成")])),_:1}),t(O,{value:"4"},{default:l(()=>e[49]||(e[49]=[d("已取消")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"优先级",prop:"priority"},{default:l(()=>[t(ae,{modelValue:o(i).priority,"onUpdate:modelValue":e[20]||(e[20]=a=>o(i).priority=a)},{default:l(()=>[t(O,{value:"0"},{default:l(()=>e[50]||(e[50]=[d("低")])),_:1}),t(O,{value:"1"},{default:l(()=>e[51]||(e[51]=[d("中")])),_:1}),t(O,{value:"2"},{default:l(()=>e[52]||(e[52]=[d("高")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"预计开始时间",prop:"plannedStartTime"},{default:l(()=>[t(oe,{modelValue:o(i).plannedStartTime,"onUpdate:modelValue":e[21]||(e[21]=a=>o(i).plannedStartTime=a),type:"datetime",placeholder:"选择预计开始时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(v,{label:"预计完成时间",prop:"plannedEndTime"},{default:l(()=>[t(oe,{modelValue:o(i).plannedEndTime,"onUpdate:modelValue":e[22]||(e[22]=a=>o(i).plannedEndTime=a),type:"datetime",placeholder:"选择预计完成时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(v,{label:"描述",prop:"description"},{default:l(()=>[t(b,{modelValue:o(i).description,"onUpdate:modelValue":e[23]||(e[23]=a=>o(i).description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ne,{modelValue:o(L).visible,"onUpdate:modelValue":e[27]||(e[27]=a=>o(L).visible=a),title:"分配车辆",width:"400px","append-to-body":""},{footer:l(()=>[Q("div",mt,[t(p,{loading:o(H),type:"primary",onClick:_e},{default:l(()=>e[55]||(e[55]=[d("确 定")])),_:1},8,["loading"]),t(p,{onClick:e[26]||(e[26]=a=>o(L).visible=!1)},{default:l(()=>e[56]||(e[56]=[d("取 消")])),_:1})])]),default:l(()=>[t(z,{ref_key:"assignFormRef",ref:pe,model:o(D),"label-width":"100px"},{default:l(()=>[t(v,{label:"车辆ID",prop:"vehicleId"},{default:l(()=>[t(F,{modelValue:o(D).vehicleId,"onUpdate:modelValue":e[25]||(e[25]=a=>o(D).vehicleId=a),placeholder:"请输入车辆ID",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Tt as default};
