import{d as _e,a as ll,h as tl,ab as fe,r as i,ag as ce,b as al,O as ol,ah as nl,c as H,o as p,m as t,q as n,w as b,p as T,e as o,C as sl,D as ve,z as ul,F as J,A as W,t as v,B as dl,Y as C,H as rl,G as m,a6 as ye,ai as il,x as R,b2 as ml,y as be,$ as pl,v as fl,S as cl,aj as vl,n as ge}from"./index-B9WM9B43.js";/* empty css                  */import{E as yl}from"./el-tree-FBGJd7y4.js";import{E as bl}from"./el-checkbox-CIZQMxKL.js";/* empty css                       */import{a as gl,E as kl}from"./el-radio-Cy5OMmSA.js";import{E as _l}from"./el-input-number-CWw6lCGD.js";import{_ as Cl}from"./index-F9iJ6oEr.js";import{E as Vl,a as Sl}from"./el-table-column-CfNB-tiT.js";import{E as wl}from"./el-row-CZ85bKL9.js";import{_ as hl}from"./index-CfXeGV0Q.js";import{E as El}from"./el-col-DjEila-N.js";import{E as Rl}from"./el-card-C9-IEzMj.js";import{a as Ul,E as Nl}from"./el-form-item-C52vg3Rn.js";import{E as Kl}from"./el-date-picker-LQDrgT3l.js";import{l as Il,e as Dl,f as Tl,g as ke,h as $l,i as xl,j as Fl,k as ql}from"./index-CcUUMJX9.js";import{r as Al,t as Ml}from"./index-CGkw-Ns8.js";import"./index-C6vhygJv.js";import"./_initCloneObject-CtNQcUp4.js";import"./_baseClone-DI-sfL8c.js";const Bl={class:"p-2"},Ol={class:"mb-[10px]"},Pl={class:"dialog-footer"},Ll={class:"dialog-footer"},Hl=_e({name:"Role"}),pt=_e({...Hl,setup(Yl){const Ce=ll(),{proxy:d}=tl(),{sys_normal_disable:X}=fe(d==null?void 0:d.useDict("sys_normal_disable")),Z=i(),Y=i(!0),$=i(!0),x=i([]),ee=i(!0),Ve=i(!0),U=i(0),N=i(["",""]),K=i([]),F=i(!1),q=i(!1),A=i(!0),M=i(!1),B=i([]),w=i(!1),Se=i([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"},{value:"6",label:"部门及以下或本人数据权限"}]),le=i(),j=i(),te=i(),g=i(),k=i(),z={roleId:void 0,roleSort:1,status:"0",roleName:"",roleKey:"",menuCheckStrictly:!0,deptCheckStrictly:!0,remark:"",dataScope:"1",menuIds:[],deptIds:[]},we=ce({form:{...z},queryParams:{pageNum:1,pageSize:10,roleName:"",roleKey:"",status:""},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),{form:s,queryParams:f,rules:he}=fe(we),y=ce({visible:!1,title:""}),V=()=>{Y.value=!0,Il(d==null?void 0:d.addDateRange(f.value,N.value)).then(a=>{Z.value=a.rows,U.value=a.total,Y.value=!1})},O=()=>{f.value.pageNum=1,V()},Ee=()=>{var a;N.value=["",""],(a=le.value)==null||a.resetFields(),O()},ae=async a=>{const e=(a==null?void 0:a.roleId)||x.value;await(d==null?void 0:d.$modal.confirm("是否确认删除角色编号为"+e+"数据项目")),await Dl(e),V(),d==null||d.$modal.msgSuccess("删除成功")},Re=()=>{d==null||d.download("system/role/export",{...f.value},`role_${new Date().getTime()}.xlsx`)},Ue=a=>{x.value=a.map(e=>e.roleId),ee.value=a.length!=1,Ve.value=!a.length},Ne=async a=>{const e=a.status==="0"?"启用":"停用";try{await(d==null?void 0:d.$modal.confirm('确认要"'+e+'""'+a.roleName+'"角色吗?')),await Tl(a.roleId,a.status),d==null||d.$modal.msgSuccess(e+"成功")}catch{a.status=a.status==="0"?"1":"0"}},Ke=a=>{Ce.push("/system/role-auth/user/"+a.roleId)},Ie=async()=>{const a=await Ml();K.value=a.data},De=()=>{var r,u;const a=(r=k.value)==null?void 0:r.getCheckedKeys(),e=(u=k.value)==null?void 0:u.getHalfCheckedKeys();return e&&(a==null||a.unshift(...e)),a},Q=()=>{var a,e;(a=g.value)==null||a.setCheckedKeys([]),F.value=!1,q.value=!1,A.value=!0,M.value=!1,s.value={...z},(e=j.value)==null||e.resetFields()},Te=()=>{Q(),Ie(),y.visible=!0,y.title="添加角色"},oe=async a=>{Q();const e=(a==null?void 0:a.roleId)||x.value[0],{data:r}=await ke(e);Object.assign(s.value,r),s.value.roleSort=Number(s.value.roleSort);const u=await $e(e);y.title="修改角色",y.visible=!0,u.checkedKeys.forEach(P=>{ge(()=>{var I;(I=g.value)==null||I.setChecked(P,!0,!1)})})},$e=a=>Al(a).then(e=>(K.value=e.data.menus,e.data)),xe=async a=>{const e=await ql(a);return B.value=e.data.depts,e.data},ne=(a,e)=>{if(e=="menu"){const r=K.value;for(let u=0;u<r.length;u++)g.value&&(g.value.store.nodesMap[r[u].id].expanded=a)}else if(e=="dept"){const r=B.value;for(let u=0;u<r.length;u++)k.value&&(k.value.store.nodesMap[r[u].id].expanded=a)}},se=(a,e)=>{var r,u;e=="menu"?(r=g.value)==null||r.setCheckedNodes(a?K.value:[]):e=="dept"&&((u=k.value)==null||u.setCheckedNodes(a?B.value:[]))},ue=(a,e)=>{e=="menu"?s.value.menuCheckStrictly=a:e=="dept"&&(s.value.deptCheckStrictly=a)},Fe=()=>{var r,u;const a=(r=g.value)==null?void 0:r.getCheckedKeys(),e=(u=g.value)==null?void 0:u.getHalfCheckedKeys();return e&&(a==null||a.unshift(...e)),a},qe=()=>{var a;(a=j.value)==null||a.validate(async e=>{e&&(s.value.menuIds=Fe(),s.value.roleId?await $l(s.value):await xl(s.value),d==null||d.$modal.msgSuccess("操作成功"),y.visible=!1,V())})},Ae=()=>{Q(),y.visible=!1},Me=a=>{var e;a!=="2"&&((e=k.value)==null||e.setCheckedKeys([]))},Be=async a=>{const e=await ke(a.roleId);Object.assign(s.value,e.data);const r=await xe(a.roleId);w.value=!0,y.title="分配数据权限",await ge(()=>{var u;(u=k.value)==null||u.setCheckedKeys(r.checkedKeys)})},Oe=async()=>{s.value.roleId&&(s.value.deptIds=De(),await Fl(s.value),d==null||d.$modal.msgSuccess("修改成功"),w.value=!1,V())},Pe=()=>{var a;(a=te.value)==null||a.resetFields(),s.value={...z},w.value=!1};return al(()=>{V()}),(a,e)=>{var me,pe;const r=sl,u=Nl,P=dl,I=ul,Le=Kl,c=rl,G=Ul,de=Rl,L=El,He=hl,Ye=wl,S=Sl,je=ml,D=pl,ze=Vl,Qe=Cl,Ge=ol("question-filled"),Je=cl,We=_l,Xe=kl,Ze=gl,h=bl,re=yl,ie=vl,_=nl("hasPermi"),el=fl;return p(),H("div",Bl,[t(il,{"enter-active-class":(me=o(d))==null?void 0:me.animate.searchAnimate.enter,"leave-active-class":(pe=o(d))==null?void 0:pe.animate.searchAnimate.leave},{default:n(()=>[b(T("div",Ol,[t(de,{shadow:"hover"},{default:n(()=>[t(G,{ref_key:"queryFormRef",ref:le,model:o(f),inline:!0},{default:n(()=>[t(u,{label:"角色名称",prop:"roleName"},{default:n(()=>[t(r,{modelValue:o(f).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>o(f).roleName=l),placeholder:"请输入角色名称",clearable:"",onKeyup:ve(O,["enter"])},null,8,["modelValue"])]),_:1}),t(u,{label:"权限字符",prop:"roleKey"},{default:n(()=>[t(r,{modelValue:o(f).roleKey,"onUpdate:modelValue":e[1]||(e[1]=l=>o(f).roleKey=l),placeholder:"请输入权限字符",clearable:"",onKeyup:ve(O,["enter"])},null,8,["modelValue"])]),_:1}),t(u,{label:"状态",prop:"status"},{default:n(()=>[t(I,{modelValue:o(f).status,"onUpdate:modelValue":e[2]||(e[2]=l=>o(f).status=l),placeholder:"角色状态",clearable:""},{default:n(()=>[(p(!0),H(J,null,W(o(X),l=>(p(),v(P,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"创建时间",style:{width:"308px"}},{default:n(()=>[t(Le,{modelValue:o(N),"onUpdate:modelValue":e[3]||(e[3]=l=>C(N)?N.value=l:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),t(u,null,{default:n(()=>[t(c,{type:"primary",icon:"Search",onClick:O},{default:n(()=>e[33]||(e[33]=[m("搜索")])),_:1}),t(c,{icon:"Refresh",onClick:Ee},{default:n(()=>e[34]||(e[34]=[m("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[ye,o($)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(de,{shadow:"hover"},{header:n(()=>[t(Ye,{gutter:10},{default:n(()=>[t(L,{span:1.5},{default:n(()=>[b((p(),v(c,{type:"primary",plain:"",icon:"Plus",onClick:e[4]||(e[4]=l=>Te())},{default:n(()=>e[35]||(e[35]=[m("新增")])),_:1})),[[_,["system:role:add"]]])]),_:1}),t(L,{span:1.5},{default:n(()=>[b((p(),v(c,{type:"success",plain:"",disabled:o(ee),icon:"Edit",onClick:e[5]||(e[5]=l=>oe())},{default:n(()=>e[36]||(e[36]=[m("修改")])),_:1},8,["disabled"])),[[_,["system:role:edit"]]])]),_:1}),t(L,{span:1.5},{default:n(()=>[b((p(),v(c,{type:"danger",plain:"",disabled:o(x).length===0,onClick:e[6]||(e[6]=l=>ae())},{default:n(()=>e[37]||(e[37]=[m("删除")])),_:1},8,["disabled"])),[[_,["system:role:delete"]]])]),_:1}),t(L,{span:1.5},{default:n(()=>[b((p(),v(c,{type:"warning",plain:"",icon:"Download",onClick:Re},{default:n(()=>e[38]||(e[38]=[m("导出")])),_:1})),[[_,["system:role:export"]]])]),_:1}),t(He,{"show-search":o($),"onUpdate:showSearch":e[7]||(e[7]=l=>C($)?$.value=l:null),onQueryTable:V},null,8,["show-search"])]),_:1})]),default:n(()=>[b((p(),v(ze,{ref:"roleTableRef",border:"",data:o(Z),onSelectionChange:Ue},{default:n(()=>[t(S,{type:"selection",width:"55",align:"center"}),R("",!0),t(S,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),t(S,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"200"}),t(S,{label:"显示顺序",prop:"roleSort",width:"100"}),t(S,{label:"状态",align:"center",width:"100"},{default:n(l=>[t(je,{modelValue:l.row.status,"onUpdate:modelValue":E=>l.row.status=E,"active-value":"0","inactive-value":"1",onChange:E=>Ne(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(S,{label:"创建时间",align:"center",prop:"createTime"},{default:n(l=>[T("span",null,be(o(d).parseTime(l.row.createTime)),1)]),_:1}),t(S,{fixed:"right",label:"操作",width:"180"},{default:n(l=>[l.row.roleId!==1?(p(),v(D,{key:0,content:"修改",placement:"top"},{default:n(()=>[b(t(c,{link:"",type:"primary",icon:"Edit",onClick:E=>oe(l.row)},null,8,["onClick"]),[[_,["system:role:edit"]]])]),_:2},1024)):R("",!0),l.row.roleId!==1?(p(),v(D,{key:1,content:"删除",placement:"top"},{default:n(()=>[b(t(c,{link:"",type:"primary",icon:"Delete",onClick:E=>ae(l.row)},null,8,["onClick"]),[[_,["system:role:remove"]]])]),_:2},1024)):R("",!0),l.row.roleId!==1?(p(),v(D,{key:2,content:"数据权限",placement:"top"},{default:n(()=>[b(t(c,{link:"",type:"primary",icon:"CircleCheck",onClick:E=>Be(l.row)},null,8,["onClick"]),[[_,["system:role:edit"]]])]),_:2},1024)):R("",!0),l.row.roleId!==1?(p(),v(D,{key:3,content:"分配用户",placement:"top"},{default:n(()=>[b(t(c,{link:"",type:"primary",icon:"User",onClick:E=>Ke(l.row)},null,8,["onClick"]),[[_,["system:role:edit"]]])]),_:2},1024)):R("",!0)]),_:1})]),_:1},8,["data"])),[[el,o(Y)]]),o(U)>0?(p(),v(Qe,{key:0,total:o(U),"onUpdate:total":e[8]||(e[8]=l=>C(U)?U.value=l:null),page:o(f).pageNum,"onUpdate:page":e[9]||(e[9]=l=>o(f).pageNum=l),limit:o(f).pageSize,"onUpdate:limit":e[10]||(e[10]=l=>o(f).pageSize=l),onPagination:V},null,8,["total","page","limit"])):R("",!0)]),_:1}),t(ie,{modelValue:o(y).visible,"onUpdate:modelValue":e[22]||(e[22]=l=>o(y).visible=l),title:o(y).title,width:"500px","append-to-body":""},{footer:n(()=>[T("div",Pl,[t(c,{type:"primary",onClick:qe},{default:n(()=>e[43]||(e[43]=[m("确 定")])),_:1}),t(c,{onClick:Ae},{default:n(()=>e[44]||(e[44]=[m("取 消")])),_:1})])]),default:n(()=>[t(G,{ref_key:"roleFormRef",ref:j,model:o(s),rules:o(he),"label-width":"100px"},{default:n(()=>[t(u,{label:"角色名称",prop:"roleName"},{default:n(()=>[t(r,{modelValue:o(s).roleName,"onUpdate:modelValue":e[11]||(e[11]=l=>o(s).roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(u,{prop:"roleKey"},{label:n(()=>[T("span",null,[t(D,{content:"控制器中定义的权限字符，如：@SaCheckRole('admin')",placement:"top"},{default:n(()=>[t(Je,null,{default:n(()=>[t(Ge)]),_:1})]),_:1}),e[39]||(e[39]=m(" 权限字符 "))])]),default:n(()=>[t(r,{modelValue:o(s).roleKey,"onUpdate:modelValue":e[12]||(e[12]=l=>o(s).roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),t(u,{label:"角色顺序",prop:"roleSort"},{default:n(()=>[t(We,{modelValue:o(s).roleSort,"onUpdate:modelValue":e[13]||(e[13]=l=>o(s).roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:n(()=>[t(Ze,{modelValue:o(s).status,"onUpdate:modelValue":e[14]||(e[14]=l=>o(s).status=l)},{default:n(()=>[(p(!0),H(J,null,W(o(X),l=>(p(),v(Xe,{key:l.value,value:l.value},{default:n(()=>[m(be(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"菜单权限"},{default:n(()=>[t(h,{modelValue:o(F),"onUpdate:modelValue":e[15]||(e[15]=l=>C(F)?F.value=l:null),onChange:e[16]||(e[16]=l=>ne(l,"menu"))},{default:n(()=>e[40]||(e[40]=[m("展开/折叠")])),_:1},8,["modelValue"]),t(h,{modelValue:o(q),"onUpdate:modelValue":e[17]||(e[17]=l=>C(q)?q.value=l:null),onChange:e[18]||(e[18]=l=>se(l,"menu"))},{default:n(()=>e[41]||(e[41]=[m("全选/全不选")])),_:1},8,["modelValue"]),t(h,{modelValue:o(s).menuCheckStrictly,"onUpdate:modelValue":e[19]||(e[19]=l=>o(s).menuCheckStrictly=l),onChange:e[20]||(e[20]=l=>ue(l,"menu"))},{default:n(()=>e[42]||(e[42]=[m("父子联动")])),_:1},8,["modelValue"]),t(re,{ref_key:"menuRef",ref:g,class:"tree-border",data:o(K),"show-checkbox":"","node-key":"id","check-strictly":!o(s).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(u,{label:"备注"},{default:n(()=>[t(r,{modelValue:o(s).remark,"onUpdate:modelValue":e[21]||(e[21]=l=>o(s).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ie,{modelValue:o(w),"onUpdate:modelValue":e[32]||(e[32]=l=>C(w)?w.value=l:null),title:o(y).title,width:"500px","append-to-body":""},{footer:n(()=>[T("div",Ll,[t(c,{type:"primary",onClick:Oe},{default:n(()=>e[48]||(e[48]=[m("确 定")])),_:1}),t(c,{onClick:Pe},{default:n(()=>e[49]||(e[49]=[m("取 消")])),_:1})])]),default:n(()=>[t(G,{ref_key:"dataScopeRef",ref:te,model:o(s),"label-width":"80px"},{default:n(()=>[t(u,{label:"角色名称"},{default:n(()=>[t(r,{modelValue:o(s).roleName,"onUpdate:modelValue":e[23]||(e[23]=l=>o(s).roleName=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(u,{label:"权限字符"},{default:n(()=>[t(r,{modelValue:o(s).roleKey,"onUpdate:modelValue":e[24]||(e[24]=l=>o(s).roleKey=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(u,{label:"权限范围"},{default:n(()=>[t(I,{modelValue:o(s).dataScope,"onUpdate:modelValue":e[25]||(e[25]=l=>o(s).dataScope=l),onChange:Me},{default:n(()=>[(p(!0),H(J,null,W(o(Se),l=>(p(),v(P,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),b(t(u,{label:"数据权限"},{default:n(()=>[t(h,{modelValue:o(A),"onUpdate:modelValue":e[26]||(e[26]=l=>C(A)?A.value=l:null),onChange:e[27]||(e[27]=l=>ne(l,"dept"))},{default:n(()=>e[45]||(e[45]=[m("展开/折叠")])),_:1},8,["modelValue"]),t(h,{modelValue:o(M),"onUpdate:modelValue":e[28]||(e[28]=l=>C(M)?M.value=l:null),onChange:e[29]||(e[29]=l=>se(l,"dept"))},{default:n(()=>e[46]||(e[46]=[m("全选/全不选")])),_:1},8,["modelValue"]),t(h,{modelValue:o(s).deptCheckStrictly,"onUpdate:modelValue":e[30]||(e[30]=l=>o(s).deptCheckStrictly=l),onChange:e[31]||(e[31]=l=>ue(l,"dept"))},{default:n(()=>e[47]||(e[47]=[m("父子联动")])),_:1},8,["modelValue"]),t(re,{ref_key:"deptRef",ref:k,class:"tree-border",data:o(B),"show-checkbox":"","default-expand-all":"","node-key":"id","check-strictly":!o(s).deptCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[ye,o(s).dataScope==="2"]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{pt as default};
