import{an as F,k as A,N as k,bp as S,ab as B,z as w,aO as x,n as E,d as P,B as I,h as U,b3 as p,d0 as $,cH as W,aW as D,ao as G,bl as J,az as Q,cw as X,b$ as Y,am as Z,r as R,ag as L,b as ee,aV as T,ar as le}from"./index-B9WM9B43.js";import{E as j}from"./el-tree-FBGJd7y4.js";const te=(e,{attrs:c,emit:o},{select:r,tree:s,key:n})=>{const h=F("tree-select");return A(()=>e.data,()=>{e.filterable&&E(()=>{var l,v;(v=s.value)==null||v.filter((l=r.value)==null?void 0:l.states.inputValue)})},{flush:"post"}),{...S(B(e),Object.keys(w.props)),...c,class:k(()=>c.class),style:k(()=>c.style),"onUpdate:modelValue":l=>o(x,l),valueKey:n,popperClass:k(()=>{const l=[h.e("popper")];return e.popperClass&&l.push(e.popperClass),l.join(" ")}),filterMethod:(l="")=>{var v;e.filterMethod?e.filterMethod(l):e.remoteMethod?e.remoteMethod(l):(v=s.value)==null||v.filter(l)}}},ae=P({extends:I,setup(e,c){const o=I.setup(e,c);delete o.selectOptionClick;const r=U().proxy;return E(()=>{o.select.states.cachedOptions.get(r.value)||o.select.onOptionCreate(r)}),A(()=>c.attrs.visible,s=>{E(()=>{o.states.visible=s})},{immediate:!0}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function H(e){return e||e===0}function z(e){return p(e)&&e.length}function g(e){return p(e)?e:H(e)?[e]:[]}function O(e,c,o,r,s){for(let n=0;n<e.length;n++){const h=e[n];if(c(h,n,e,s))return r?r(h,n,e,s):h;{const C=o(h);if(z(C)){const l=O(C,c,o,r,h);if(l)return l}}}}function M(e,c,o,r){for(let s=0;s<e.length;s++){const n=e[s];c(n,s,e,r);const h=o(n);z(h)&&M(h,c,o,n)}}const ce=(e,{attrs:c,slots:o,emit:r},{select:s,tree:n,key:h})=>{A(()=>e.modelValue,()=>{e.showCheckbox&&E(()=>{const t=n.value;t&&!J(t.getCheckedKeys(),g(e.modelValue))&&t.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:h.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),l=(t,a)=>{var d;const u=C.value[t];return G(u)?u(a,(d=n.value)==null?void 0:d.getNode(l("value",a))):a[u]},v=g(e.modelValue).map(t=>O(e.data||[],a=>l("value",a)===t,a=>l("children",a),(a,d,u,f)=>f&&l("value",f))).filter(t=>H(t)),_=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return M(e.data.concat(e.cacheData),a=>{const d=l("value",a);t.push({value:d,currentLabel:l("label",a),isDisabled:l("disabled",a)})},a=>l("children",a)),t}),b=()=>{var t;return(t=n.value)==null?void 0:t.getCheckedKeys().filter(a=>{var d;const u=(d=n.value)==null?void 0:d.getNode(a);return!D(u)&&W(u.childNodes)})};return{...S(B(e),Object.keys(j.props)),...c,nodeKey:h,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(t,{node:a,data:d,store:u})=>t(ae,{value:l("value",d),label:l("label",d),disabled:l("disabled",d),visible:a.visible},e.renderContent?()=>e.renderContent(t,{node:a,data:d,store:u}):o.default?()=>o.default({node:a,data:d,store:u}):void 0),filterNodeMethod:(t,a,d)=>e.filterNodeMethod?e.filterNodeMethod(t,a,d):t?new RegExp($(t),"i").test(l("label",a)||""):!0,onNodeClick:(t,a,d)=>{var u,f,m,K;if((u=c.onNodeClick)==null||u.call(c,t,a,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||a.isLeaf)){if(!l("disabled",t)){const N=(f=s.value)==null?void 0:f.states.options.get(l("value",t));(m=s.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(K=s.value)==null||K.focus()}},onCheck:(t,a)=>{var d;if(!e.showCheckbox)return;const u=l("value",t),f={};M([n.value.store.root],i=>f[i.key]=i,i=>i.childNodes);const m=a.checkedKeys,K=e.multiple?g(e.modelValue).filter(i=>!(i in f)&&!m.includes(i)):[],N=K.concat(m);if(e.checkStrictly)r(x,e.multiple?N:N.includes(u)?u:void 0);else if(e.multiple){const i=b();r(x,K.concat(i))}else{const i=O([t],y=>!z(l("children",y))&&!l("disabled",y),y=>l("children",y)),V=i?l("value",i):void 0,q=H(e.modelValue)&&!!O([t],y=>l("value",y)===e.modelValue,y=>l("children",y));r(x,V===e.modelValue||q?void 0:V)}E(()=>{var i;const V=g(e.modelValue);n.value.setCheckedKeys(V),(i=c.onCheck)==null||i.call(c,t,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})}),(d=s.value)==null||d.focus()},onNodeExpand:(t,a,d)=>{var u;(u=c.onNodeExpand)==null||u.call(c,t,a,d),E(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&a.checked){const f={},m=n.value.getCheckedKeys();M([n.value.store.root],i=>f[i.key]=i,i=>i.childNodes);const K=g(e.modelValue).filter(i=>!(i in f)&&!m.includes(i)),N=b();r(x,K.concat(N))}})},cacheOptions:_}};var ne=P({props:{data:{type:Array,default:()=>[]}},setup(e){const c=Q(X);return A(()=>e.data,()=>{var o;e.data.forEach(s=>{c.states.cachedOptions.has(s.value)||c.states.cachedOptions.set(s.value,s)});const r=((o=c.selectRef)==null?void 0:o.querySelectorAll("input"))||[];Y&&!Array.from(r).includes(document.activeElement)&&c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const se=P({name:"ElTreeSelect",inheritAttrs:!1,props:{...w.props,...j.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:o,expose:r}=c,s=R(),n=R(),h=k(()=>e.nodeKey||e.valueKey||"value"),C=te(e,c,{select:s,tree:n,key:h}),{cacheOptions:l,...v}=ce(e,c,{select:s,tree:n,key:h}),_=L({});return r(_),ee(()=>{Object.assign(_,{...S(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...S(s.value,["focus","blur","selectedLabel"])})}),()=>T(w,L({...C,ref:b=>s.value=b}),{...o,default:()=>[T(ne,{data:l.value}),T(j,L({...v,ref:b=>n.value=b}))]})}});var de=Z(se,[["__file","tree-select.vue"]]);const ue=le(de);export{ue as E};
