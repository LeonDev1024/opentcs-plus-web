import{d as T,u as K,h as L,r as i,b as P,c as z,o as C,p as s,m as o,q as n,C as G,e as l,w,v as H,t as M,y as S,a6 as Y,Y as V,G as x,H as J,n as Q}from"./index-B9WM9B43.js";import{_ as W}from"./index-F9iJ6oEr.js";import{a as X,E as Z}from"./el-table-column-CfNB-tiT.js";import"./el-checkbox-CIZQMxKL.js";import{E as ee,a as te}from"./el-form-item-C52vg3Rn.js";import{E as le}from"./el-row-CZ85bKL9.js";import{E as oe}from"./el-col-DjEila-N.js";import{c as ae,d as ne}from"./index-CUfbmLco.js";import"./_initCloneObject-CtNQcUp4.js";import"./_baseClone-DI-sfL8c.js";const se={class:"p-2"},ie={class:"panel"},re={class:"panel"},ue={style:{"text-align":"center","margin-left":"-120px","margin-top":"30px"}},de=T({name:"AuthRole"}),Ne=T({...de,setup(me){const k=K(),{proxy:r}=L(),g=i(!0),v=i(0),m=i(1),p=i(10),E=i([]),_=i([]),u=i({nickName:void 0,userName:"",userId:void 0}),b=i(),h=t=>{var e;I(t)&&(t.flag=!t.flag,(e=b.value)==null||e.toggleRowSelection(t,t.flag))},B=t=>{E.value=t.map(e=>e.roleId)},$=t=>String(t.roleId),I=t=>t.status==="0",N=()=>{const t={fullPath:"",hash:"",matched:[],meta:void 0,name:void 0,params:void 0,query:void 0,redirectedFrom:void 0,path:"/system/user"};r==null||r.$tab.closeOpenPage(t)},j=async()=>{const t=u.value.userId,e=E.value.join(",");await ae({userId:t,roleIds:e}),r==null||r.$modal.msgSuccess("授权成功"),N()},F=async()=>{const t=k.params&&k.params.userId;if(t){g.value=!0;const e=await ne(t);Object.assign(u.value,e.data.user),Object.assign(_.value,e.data.roles),v.value=_.value.length,await Q(()=>{_.value.forEach(d=>{var f;d!=null&&d.flag&&((f=b.value)==null||f.toggleRowSelection(d,!0))})}),g.value=!1}};return P(()=>{F()}),(t,e)=>{const d=G,f=ee,R=oe,U=le,A=te,c=X,O=Z,q=W,y=J,D=H;return C(),z("div",se,[s("div",ie,[e[6]||(e[6]=s("h4",{class:"panel-title"},"基本信息",-1)),o(A,{model:l(u),inline:!0},{default:n(()=>[o(U,{gutter:10},{default:n(()=>[o(R,{span:2.5},{default:n(()=>[o(f,{label:"用户昵称",prop:"nickName"},{default:n(()=>[o(d,{modelValue:l(u).nickName,"onUpdate:modelValue":e[0]||(e[0]=a=>l(u).nickName=a),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),o(R,{span:2.5},{default:n(()=>[o(f,{label:"登录账号",prop:"userName"},{default:n(()=>[o(d,{modelValue:l(u).userName,"onUpdate:modelValue":e[1]||(e[1]=a=>l(u).userName=a),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",re,[e[10]||(e[10]=s("h4",{class:"panel-title"},"角色信息",-1)),s("div",null,[w((C(),M(O,{ref_key:"tableRef",ref:b,border:"","row-key":$,data:l(_).slice((l(m)-1)*l(p),l(m)*l(p)),onRowClick:h,onSelectionChange:B},{default:n(()=>[o(c,{label:"序号",width:"55",type:"index",align:"center"},{default:n(a=>[s("span",null,S((l(m)-1)*l(p)+a.$index+1),1)]),_:1}),o(c,{type:"selection","reserve-selection":!0,selectable:I,width:"55"}),o(c,{label:"角色编号",align:"center",prop:"roleId"}),o(c,{label:"角色名称",align:"center",prop:"roleName"}),o(c,{label:"权限字符",align:"center",prop:"roleKey"}),o(c,{label:"创建时间",align:"center",prop:"createTime",width:"180"},{default:n(a=>[s("span",null,S(l(r).parseTime(a.row.createTime)),1)]),_:1})]),_:1},8,["data"])),[[D,l(g)]]),w(o(q,{page:l(m),"onUpdate:page":e[2]||(e[2]=a=>V(m)?m.value=a:null),limit:l(p),"onUpdate:limit":e[3]||(e[3]=a=>V(p)?p.value=a:null),total:l(v)},null,8,["page","limit","total"]),[[Y,l(v)>0]]),s("div",ue,[o(y,{type:"primary",onClick:e[4]||(e[4]=a=>j())},{default:n(()=>e[7]||(e[7]=[x("提交")])),_:1}),o(y,{onClick:e[5]||(e[5]=a=>N())},{default:n(()=>e[8]||(e[8]=[x("返回")])),_:1})]),e[9]||(e[9]=s("div",null,null,-1))])])])}}});export{Ne as default};
