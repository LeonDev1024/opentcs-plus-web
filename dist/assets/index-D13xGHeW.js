import{d as Z,h as Ce,r,ag as Y,ab as he,b as we,ah as Ve,c as Ee,o as y,m as t,q as n,w as f,p as W,e as o,C as Pe,D as Ne,H as Te,G as c,a6 as X,ai as Se,t as w,x as Ie,b2 as Ue,$ as xe,v as $e,Y as q,aj as De,J as Fe,n as Re}from"./index-B9WM9B43.js";/* empty css                  */import{E as qe}from"./el-tree-FBGJd7y4.js";import{E as Be}from"./el-checkbox-CIZQMxKL.js";import{_ as Ke}from"./index-F9iJ6oEr.js";import{E as Ae,a as Le}from"./el-table-column-CfNB-tiT.js";import{E as Me}from"./el-row-CZ85bKL9.js";import{_ as ze}from"./index-CfXeGV0Q.js";import{E as Qe}from"./el-col-DjEila-N.js";import{E as He}from"./el-card-C9-IEzMj.js";import{a as je,E as Ge}from"./el-form-item-C52vg3Rn.js";import{l as Je,c as Oe,g as Ye,u as We,a as Xe,d as Ze}from"./index-DvFyezMC.js";import{b as ea}from"./index-CGkw-Ns8.js";import"./_initCloneObject-CtNQcUp4.js";import"./_baseClone-DI-sfL8c.js";const aa={class:"p-2"},ta={class:"mb-[10px]"},la={class:"dialog-footer"},na=Z({name:"TenantPackage"}),Ca=Z({...na,setup(oa){const{proxy:s}=Ce(),B=r([]),V=r(!1),b=r(!0),E=r(!0),U=r([]),K=r(!0),A=r(!0),x=r(0),P=r(!1),N=r(!1),T=r([]),k=r(),L=r(),$=r(),g=Y({visible:!1,title:""}),M={packageId:void 0,packageName:"",menuIds:"",remark:"",menuCheckStrictly:!0},ee=Y({form:{...M},queryParams:{pageNum:1,pageSize:10,packageName:""},rules:{packageId:[{required:!0,message:"租户套餐id不能为空",trigger:"blur"}],packageName:[{required:!0,message:"套餐名称不能为空",trigger:"blur"}]}}),{queryParams:p,form:d,rules:ae}=he(ee),te=()=>{var i,u;const a=(i=k.value)==null?void 0:i.getCheckedKeys(),e=(u=k.value)==null?void 0:u.getHalfCheckedKeys();return e&&(a==null||a.unshift(...e)),a},z=async a=>{const e=await ea(a);return T.value=e.data.menus,Promise.resolve(e)},v=async()=>{b.value=!0;const a=await Je(p.value);B.value=a.rows,x.value=a.total,b.value=!1},le=async a=>{const e=a.status==="0"?"启用":"停用",[i]=await Fe(s==null?void 0:s.$modal.confirm('确认要"'+e+'""'+a.packageName+'"套餐吗？'));i?a.status=a.status==="0"?"1":"0":(await Oe(a.packageId,a.status),s==null||s.$modal.msgSuccess(e+"成功"))},ne=()=>{D(),g.visible=!1},D=()=>{var a,e;(a=k.value)==null||a.setCheckedKeys([]),P.value=!1,N.value=!1,d.value={...M},(e=$.value)==null||e.resetFields()},F=()=>{p.value.pageNum=1,v()},oe=()=>{var a;(a=L.value)==null||a.resetFields(),F()},se=a=>{U.value=a.map(e=>e.packageId),K.value=a.length!=1,A.value=!a.length},ie=(a,e)=>{{const i=T.value;for(let u=0;u<i.length;u++)k.value&&(k.value.store.nodesMap[i[u].id].expanded=a)}},de=(a,e)=>{var i;(i=k.value)==null||i.setCheckedNodes(a?T.value:[])},ue=(a,e)=>{d.value.menuCheckStrictly=a},re=async()=>{D(),await z(0),g.visible=!0,g.title="添加租户套餐"},Q=async a=>{D();const e=(a==null?void 0:a.packageId)||U.value[0],i=await Ye(e);d.value=i.data;const u=await z(e);g.visible=!0,g.title="修改租户套餐",u.data.checkedKeys.forEach(m=>{Re(()=>{var C;(C=k.value)==null||C.setChecked(m,!0,!1)})})},me=()=>{var a;(a=$.value)==null||a.validate(async e=>{e&&(V.value=!0,d.value.menuIds=te(),d.value.packageId!=null?await We(d.value).finally(()=>V.value=!1):await Xe(d.value).finally(()=>V.value=!1),s==null||s.$modal.msgSuccess("操作成功"),g.visible=!1,await v())})},H=async a=>{const e=(a==null?void 0:a.packageId)||U.value;await(s==null?void 0:s.$modal.confirm('是否确认删除租户套餐编号为"'+e+'"的数据项？').finally(()=>{b.value=!1})),await Ze(e),b.value=!0,await v(),s==null||s.$modal.msgSuccess("删除成功")},ce=()=>{s==null||s.download("system/tenant/package/export",{...p.value},`tenantPackage_${new Date().getTime()}.xlsx`)};return we(()=>{v()}),(a,e)=>{var J,O;const i=Pe,u=Ge,m=Te,C=je,j=He,S=Qe,pe=ze,ge=Me,h=Le,fe=Ue,G=xe,ke=Ae,ve=Ke,R=Be,_e=qe,ye=De,_=Ve("hasPermi"),be=$e;return y(),Ee("div",aa,[t(Se,{"enter-active-class":(J=o(s))==null?void 0:J.animate.searchAnimate.enter,"leave-active-class":(O=o(s))==null?void 0:O.animate.searchAnimate.leave},{default:n(()=>[f(W("div",ta,[t(j,{shadow:"hover"},{default:n(()=>[t(C,{ref_key:"queryFormRef",ref:L,model:o(p),inline:!0},{default:n(()=>[t(u,{label:"套餐名称",prop:"packageName"},{default:n(()=>[t(i,{modelValue:o(p).packageName,"onUpdate:modelValue":e[0]||(e[0]=l=>o(p).packageName=l),placeholder:"请输入套餐名称",clearable:"",onKeyup:Ne(F,["enter"])},null,8,["modelValue"])]),_:1}),t(u,null,{default:n(()=>[t(m,{type:"primary",icon:"Search",onClick:F},{default:n(()=>e[15]||(e[15]=[c("搜索")])),_:1}),t(m,{icon:"Refresh",onClick:oe},{default:n(()=>e[16]||(e[16]=[c("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[X,o(E)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(j,{shadow:"hover"},{header:n(()=>[t(ge,{gutter:10,class:"mb8"},{default:n(()=>[t(S,{span:1.5},{default:n(()=>[f((y(),w(m,{type:"primary",plain:"",icon:"Plus",onClick:re},{default:n(()=>e[17]||(e[17]=[c(" 新增 ")])),_:1})),[[_,["system:tenantPackage:add"]]])]),_:1}),t(S,{span:1.5},{default:n(()=>[f((y(),w(m,{type:"success",plain:"",icon:"Edit",disabled:o(K),onClick:e[1]||(e[1]=l=>Q())},{default:n(()=>e[18]||(e[18]=[c(" 修改 ")])),_:1},8,["disabled"])),[[_,["system:tenantPackage:edit"]]])]),_:1}),t(S,{span:1.5},{default:n(()=>[f((y(),w(m,{type:"danger",plain:"",icon:"Delete",disabled:o(A),onClick:e[2]||(e[2]=l=>H())},{default:n(()=>e[19]||(e[19]=[c(" 删除 ")])),_:1},8,["disabled"])),[[_,["system:tenantPackage:remove"]]])]),_:1}),t(S,{span:1.5},{default:n(()=>[f((y(),w(m,{type:"warning",plain:"",icon:"Download",onClick:ce},{default:n(()=>e[20]||(e[20]=[c("导出 ")])),_:1})),[[_,["system:tenantPackage:export"]]])]),_:1}),t(pe,{"show-search":o(E),"onUpdate:showSearch":e[3]||(e[3]=l=>q(E)?E.value=l:null),onQueryTable:v},null,8,["show-search"])]),_:1})]),default:n(()=>[f((y(),w(ke,{border:"",data:o(B),onSelectionChange:se},{default:n(()=>[t(h,{type:"selection",width:"55",align:"center"}),Ie("",!0),t(h,{label:"套餐名称",align:"center",prop:"packageName"}),t(h,{label:"备注",align:"center",prop:"remark"}),t(h,{label:"状态",align:"center",prop:"status"},{default:n(l=>[t(fe,{modelValue:l.row.status,"onUpdate:modelValue":I=>l.row.status=I,"active-value":"0","inactive-value":"1",onClick:I=>le(l.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),t(h,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:n(l=>[t(G,{content:"修改",placement:"top"},{default:n(()=>[f(t(m,{link:"",type:"primary",icon:"Edit",onClick:I=>Q(l.row)},null,8,["onClick"]),[[_,["system:tenantPackage:edit"]]])]),_:2},1024),t(G,{content:"删除",placement:"top"},{default:n(()=>[f(t(m,{link:"",type:"primary",icon:"Delete",onClick:I=>H(l.row)},null,8,["onClick"]),[[_,["system:tenantPackage:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[be,o(b)]]),f(t(ve,{page:o(p).pageNum,"onUpdate:page":e[4]||(e[4]=l=>o(p).pageNum=l),limit:o(p).pageSize,"onUpdate:limit":e[5]||(e[5]=l=>o(p).pageSize=l),total:o(x),onPagination:v},null,8,["page","limit","total"]),[[X,o(x)>0]])]),_:1}),t(ye,{modelValue:o(g).visible,"onUpdate:modelValue":e[14]||(e[14]=l=>o(g).visible=l),title:o(g).title,width:"500px","append-to-body":""},{footer:n(()=>[W("div",la,[t(m,{loading:o(V),type:"primary",onClick:me},{default:n(()=>e[24]||(e[24]=[c("确 定")])),_:1},8,["loading"]),t(m,{onClick:ne},{default:n(()=>e[25]||(e[25]=[c("取 消")])),_:1})])]),default:n(()=>[t(C,{ref_key:"tenantPackageFormRef",ref:$,model:o(d),rules:o(ae),"label-width":"80px"},{default:n(()=>[t(u,{label:"套餐名称",prop:"packageName"},{default:n(()=>[t(i,{modelValue:o(d).packageName,"onUpdate:modelValue":e[6]||(e[6]=l=>o(d).packageName=l),placeholder:"请输入套餐名称"},null,8,["modelValue"])]),_:1}),t(u,{label:"关联菜单"},{default:n(()=>[t(R,{modelValue:o(P),"onUpdate:modelValue":e[7]||(e[7]=l=>q(P)?P.value=l:null),onChange:e[8]||(e[8]=l=>ie(l,"menu"))},{default:n(()=>e[21]||(e[21]=[c("展开/折叠")])),_:1},8,["modelValue"]),t(R,{modelValue:o(N),"onUpdate:modelValue":e[9]||(e[9]=l=>q(N)?N.value=l:null),onChange:e[10]||(e[10]=l=>de(l,"menu"))},{default:n(()=>e[22]||(e[22]=[c("全选/全不选 ")])),_:1},8,["modelValue"]),t(R,{modelValue:o(d).menuCheckStrictly,"onUpdate:modelValue":e[11]||(e[11]=l=>o(d).menuCheckStrictly=l),onChange:e[12]||(e[12]=l=>ue(l,"menu"))},{default:n(()=>e[23]||(e[23]=[c("父子联动 ")])),_:1},8,["modelValue"]),t(_e,{ref_key:"menuTreeRef",ref:k,class:"tree-border",data:o(T),"show-checkbox":"","node-key":"id","check-strictly":!o(d).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(u,{label:"备注",prop:"remark"},{default:n(()=>[t(i,{modelValue:o(d).remark,"onUpdate:modelValue":e[13]||(e[13]=l=>o(d).remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Ca as default};
