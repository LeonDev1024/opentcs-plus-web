import{d as D,h as T,i as A,a as P,j,r as i,k as G,b as H,c as I,o as u,m as l,p as m,q as s,t as x,x as q,y,e,z as J,F as O,A as Q,B as W,_ as X,C as Y,D as U,G as Z,H as ee,I as te,J as oe,K as ae,L as le,M as ne}from"./index-B9WM9B43.js";import{E as se,a as re}from"./el-form-item-C52vg3Rn.js";import{E as ie}from"./el-checkbox-CIZQMxKL.js";import"./_baseClone-DI-sfL8c.js";import"./_initCloneObject-CtNQcUp4.js";const de={class:"login"},ue={class:"title-box"},ce={class:"title"},me={class:"login-code"},pe=["src"],ge={key:0},_e={key:1},fe=D({__name:"login",setup(ve){const{proxy:d}=T(),L="机器人调度管理平台",B=A(),E=P(),{t:f}=j(),t=i({tenantId:"000000",username:"admin",password:"admin123",rememberMe:!1,code:"",uuid:""}),$={tenantId:[{required:!0,trigger:"blur",message:f("login.rule.tenantId.required")}],username:[{required:!0,trigger:"blur",message:f("login.rule.username.required")}],password:[{required:!0,trigger:"blur",message:f("login.rule.password.required")}],code:[{required:!0,trigger:"change",message:f("login.rule.code.required")}]},k=i(""),p=i(!1),v=i(!0),b=i(!0),C=i("/"),M=i(),g=i([]);G(()=>E.currentRoute.value,a=>{C.value=a.query&&a.query.redirect&&decodeURIComponent(a.query.redirect)},{immediate:!0});const w=()=>{var a;(a=M.value)==null||a.validate(async(o,c)=>{if(o){p.value=!0,t.value.rememberMe?(localStorage.setItem("tenantId",String(t.value.tenantId)),localStorage.setItem("username",String(t.value.username)),localStorage.setItem("password",String(t.value.password)),localStorage.setItem("rememberMe",String(t.value.rememberMe))):(localStorage.removeItem("tenantId"),localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("rememberMe"));const[r]=await oe(B.login(t.value));if(r)p.value=!1,v.value&&await h();else{const S=C.value||"/";await E.push(S),p.value=!1}}else console.log("error submit!",c)})},h=async()=>{const a=await ae(),{data:o}=a;v.value=o.captchaEnabled===void 0?!0:o.captchaEnabled,v.value&&(k.value="data:image/gif;base64,"+o.img,t.value.uuid=o.uuid)},R=()=>{const a=localStorage.getItem("tenantId"),o=localStorage.getItem("username"),c=localStorage.getItem("password"),r=localStorage.getItem("rememberMe");t.value={tenantId:a===null?String(t.value.tenantId):a,username:o===null?String(t.value.username):o,password:String(c===null?t.value.password:c),rememberMe:r===null?!1:!!r}},z=async()=>{const{data:a}=await le(!1);b.value=a.tenantEnabled===void 0?!0:a.tenantEnabled,b.value&&(g.value=a.voList,g.value!=null&&g.value.length!==0&&(t.value.tenantId=g.value[0].tenantId))};return H(()=>{h(),z(),R()}),(a,o)=>{const c=W,r=X,S=J,_=se,V=Y,F=ie,N=ee,K=re;return u(),I("div",de,[l(K,{ref_key:"loginRef",ref:M,model:e(t),rules:$,class:"login-form"},{default:s(()=>[m("div",ue,[m("h3",ce,y(e(L)),1)]),e(b)?(u(),x(_,{key:0,prop:"tenantId"},{default:s(()=>[l(S,{modelValue:e(t).tenantId,"onUpdate:modelValue":o[0]||(o[0]=n=>e(t).tenantId=n),filterable:"",placeholder:e(d).$t("login.selectPlaceholder"),style:{width:"100%"}},{prefix:s(()=>[l(r,{"icon-class":"company",class:"el-input__icon input-icon"})]),default:s(()=>[(u(!0),I(O,null,Q(e(g),n=>(u(),x(c,{key:n.tenantId,label:n.companyName,value:n.tenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1})):q("",!0),l(_,{prop:"username"},{default:s(()=>[l(V,{modelValue:e(t).username,"onUpdate:modelValue":o[1]||(o[1]=n=>e(t).username=n),type:"text",size:"large","auto-complete":"off",placeholder:e(d).$t("login.username")},{prefix:s(()=>[l(r,{"icon-class":"user",class:"el-input__icon input-icon"})]),_:1},8,["modelValue","placeholder"])]),_:1}),l(_,{prop:"password"},{default:s(()=>[l(V,{modelValue:e(t).password,"onUpdate:modelValue":o[2]||(o[2]=n=>e(t).password=n),type:"password",size:"large","auto-complete":"off",placeholder:e(d).$t("login.password"),onKeyup:U(w,["enter"])},{prefix:s(()=>[l(r,{"icon-class":"password",class:"el-input__icon input-icon"})]),_:1},8,["modelValue","placeholder"])]),_:1}),e(v)?(u(),x(_,{key:1,prop:"code"},{default:s(()=>[l(V,{modelValue:e(t).code,"onUpdate:modelValue":o[3]||(o[3]=n=>e(t).code=n),size:"large","auto-complete":"off",placeholder:e(d).$t("login.code"),style:{width:"63%"},onKeyup:U(w,["enter"])},{prefix:s(()=>[l(r,{"icon-class":"validCode",class:"el-input__icon input-icon"})]),_:1},8,["modelValue","placeholder"]),m("div",me,[m("img",{src:e(k),class:"login-code-img",onClick:h},null,8,pe)])]),_:1})):q("",!0),l(F,{modelValue:e(t).rememberMe,"onUpdate:modelValue":o[4]||(o[4]=n=>e(t).rememberMe=n),style:{margin:"0 0 25px 0"}},{default:s(()=>[Z(y(e(d).$t("login.rememberPassword")),1)]),_:1},8,["modelValue"]),l(_,{style:{width:"100%"}},{default:s(()=>[l(N,{loading:e(p),size:"large",type:"primary",style:{width:"100%"},onClick:te(w,["prevent"])},{default:s(()=>[e(p)?(u(),I("span",_e,y(e(d).$t("login.logging")),1)):(u(),I("span",ge,y(e(d).$t("login.login")),1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o[5]||(o[5]=m("div",{class:"el-login-footer"},[m("span",null,"Copyright © 2025 lyc All Rights Reserved.")],-1))])}}}),Se=ne(fe,[["__scopeId","data-v-3347a74d"]]);export{Se as default};
