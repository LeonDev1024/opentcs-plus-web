import{a9 as S,d as J,h as _e,ab as H,r as p,ag as fe,b as ge,ah as ve,c as k,o as u,m as e,q as a,w as c,p as I,e as l,C as be,D as N,z as we,F as Q,A as j,t as f,B as he,Y as G,H as ye,G as b,a6 as W,ai as Te,y as x,$ as Ve,v as Ce}from"./index-B9WM9B43.js";import{_ as Ee}from"./index-F9iJ6oEr.js";import{E as De,a as ke}from"./el-table-column-CfNB-tiT.js";import"./el-checkbox-CIZQMxKL.js";import{_ as Ie}from"./index-vINeM9IP.js";import{E as Ne}from"./el-row-CZ85bKL9.js";import{_ as Se}from"./index-CfXeGV0Q.js";import{E as Re}from"./el-col-DjEila-N.js";import{E as Ue}from"./el-card-C9-IEzMj.js";import{a as Be,E as Fe}from"./el-form-item-C52vg3Rn.js";import{E as $e}from"./el-date-picker-LQDrgT3l.js";import qe from"./oper-info-dialog-CQlheD2B.js";import"./_initCloneObject-CtNQcUp4.js";import"./el-tree-FBGJd7y4.js";import"./_baseClone-DI-sfL8c.js";import"./index-C6vhygJv.js";/* empty css                  */import"./el-descriptions-item-BMqIgY0I.js";function Le(w){return S({url:"/monitor/operlog/list",method:"get",params:w})}function Pe(w){return S({url:"/monitor/operlog/"+w,method:"delete"})}function Ae(){return S({url:"/monitor/operlog/clean",method:"delete"})}const Me={class:"p-2"},Oe={class:"mb-[10px]"},Ye=J({name:"Operlog"}),po=J({...Ye,setup(w){const{proxy:n}=_e(),{sys_oper_type:R,sys_common_status:U}=H(n==null?void 0:n.useDict("sys_oper_type","sys_common_status")),B=p([]),V=p(!0),h=p(!0),F=p([]),$=p(!0),C=p(0),g=p(["",""]),v=p({prop:"operTime",order:"descending"}),q=p(),L=p(),X=fe({form:{operId:void 0,tenantId:void 0,title:"",businessType:0,businessTypes:void 0,method:"",requestMethod:"",operatorType:0,operName:"",deptName:"",operUrl:"",operIp:"",operLocation:"",operParam:"",jsonResult:"",status:0,errorMsg:"",operTime:"",costTime:0},queryParams:{pageNum:1,pageSize:10,operIp:"",title:"",operName:"",businessType:"",status:"",orderByColumn:v.value.prop,isAsc:v.value.order},rules:{}}),{queryParams:r,form:ze}=H(X),d=async()=>{V.value=!0;const s=await Le(n==null?void 0:n.addDateRange(r.value,g.value));B.value=s.rows,C.value=s.total,V.value=!1},y=()=>{r.value.pageNum=1,d()},Z=()=>{var s,o;g.value=["",""],(s=L.value)==null||s.resetFields(),r.value.pageNum=1,(o=q.value)==null||o.sort(v.value.prop,v.value.order)},ee=s=>{F.value=s.map(o=>o.operId),$.value=!s.length},oe=s=>{r.value.orderByColumn=s.prop,r.value.isAsc=s.order,d()},P=p(),te=s=>{P.value.openDialog(s)},le=async s=>{const o=F.value;await(n==null?void 0:n.$modal.confirm('是否确认删除日志编号为"'+o+'"的数据项?')),await Pe(o),await d(),n==null||n.$modal.msgSuccess("删除成功")},ae=async()=>{await(n==null?void 0:n.$modal.confirm("是否确认清空所有操作日志数据项?")),await Ae(),await d(),n==null||n.$modal.msgSuccess("清空成功")},ne=()=>{n==null||n.download("monitor/operlog/export",{...r.value},`config_${new Date().getTime()}.xlsx`)};return ge(()=>{d()}),(s,o)=>{var z,K;const E=be,m=Fe,A=he,M=we,re=$e,_=ye,se=Be,O=Ue,D=Re,ie=Se,pe=Ne,i=ke,Y=Ie,ue=Ve,de=De,me=Ee,T=ve("hasPermi"),ce=Ce;return u(),k("div",Me,[e(Te,{"enter-active-class":(z=l(n))==null?void 0:z.animate.searchAnimate.enter,"leave-active-class":(K=l(n))==null?void 0:K.animate.searchAnimate.leave},{default:a(()=>[c(I("div",Oe,[e(O,{shadow:"hover"},{default:a(()=>[e(se,{ref_key:"queryFormRef",ref:L,model:l(r),inline:!0},{default:a(()=>[e(m,{label:"操作地址",prop:"operIp"},{default:a(()=>[e(E,{modelValue:l(r).operIp,"onUpdate:modelValue":o[0]||(o[0]=t=>l(r).operIp=t),placeholder:"请输入操作地址",clearable:"",onKeyup:N(y,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"系统模块",prop:"title"},{default:a(()=>[e(E,{modelValue:l(r).title,"onUpdate:modelValue":o[1]||(o[1]=t=>l(r).title=t),placeholder:"请输入系统模块",clearable:"",onKeyup:N(y,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"操作人员",prop:"operName"},{default:a(()=>[e(E,{modelValue:l(r).operName,"onUpdate:modelValue":o[2]||(o[2]=t=>l(r).operName=t),placeholder:"请输入操作人员",clearable:"",onKeyup:N(y,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"类型",prop:"businessType"},{default:a(()=>[e(M,{modelValue:l(r).businessType,"onUpdate:modelValue":o[3]||(o[3]=t=>l(r).businessType=t),placeholder:"操作类型",clearable:""},{default:a(()=>[(u(!0),k(Q,null,j(l(R),t=>(u(),f(A,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"状态",prop:"status"},{default:a(()=>[e(M,{modelValue:l(r).status,"onUpdate:modelValue":o[4]||(o[4]=t=>l(r).status=t),placeholder:"操作状态",clearable:""},{default:a(()=>[(u(!0),k(Q,null,j(l(U),t=>(u(),f(A,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"操作时间",style:{width:"308px"}},{default:a(()=>[e(re,{modelValue:l(g),"onUpdate:modelValue":o[5]||(o[5]=t=>G(g)?g.value=t:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(m,null,{default:a(()=>[e(_,{type:"primary",icon:"Search",onClick:y},{default:a(()=>o[10]||(o[10]=[b("搜索")])),_:1}),e(_,{icon:"Refresh",onClick:Z},{default:a(()=>o[11]||(o[11]=[b("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[W,l(h)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(O,{shadow:"hover"},{header:a(()=>[e(pe,{gutter:10,class:"mb8"},{default:a(()=>[e(D,{span:1.5},{default:a(()=>[c((u(),f(_,{type:"danger",plain:"",icon:"Delete",disabled:l($),onClick:o[6]||(o[6]=t=>le())},{default:a(()=>o[12]||(o[12]=[b(" 删除 ")])),_:1},8,["disabled"])),[[T,["monitor:operlog:remove"]]])]),_:1}),e(D,{span:1.5},{default:a(()=>[c((u(),f(_,{type:"danger",plain:"",icon:"WarnTriangleFilled",onClick:ae},{default:a(()=>o[13]||(o[13]=[b("清空")])),_:1})),[[T,["monitor:operlog:remove"]]])]),_:1}),e(D,{span:1.5},{default:a(()=>[c((u(),f(_,{type:"warning",plain:"",icon:"Download",onClick:ne},{default:a(()=>o[14]||(o[14]=[b("导出")])),_:1})),[[T,["monitor:operlog:export"]]])]),_:1}),e(ie,{"show-search":l(h),"onUpdate:showSearch":o[7]||(o[7]=t=>G(h)?h.value=t:null),onQueryTable:d},null,8,["show-search"])]),_:1})]),default:a(()=>[c((u(),f(de,{ref_key:"operLogTableRef",ref:q,data:l(B),border:"","default-sort":l(v),onSelectionChange:ee,onSortChange:oe},{default:a(()=>[e(i,{type:"selection",width:"50",align:"center"}),e(i,{label:"日志编号",align:"center",prop:"operId"}),e(i,{label:"系统模块",align:"center",prop:"title","show-overflow-tooltip":!0}),e(i,{label:"操作类型",align:"center",prop:"businessType"},{default:a(t=>[e(Y,{options:l(R),value:t.row.businessType},null,8,["options","value"])]),_:1}),e(i,{label:"操作人员",align:"center",width:"110",prop:"operName","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]}),e(i,{label:"部门",align:"center",prop:"deptName",width:"130","show-overflow-tooltip":!0}),e(i,{label:"操作地址",align:"center",prop:"operIp",width:"130","show-overflow-tooltip":!0}),e(i,{label:"操作状态",align:"center",prop:"status"},{default:a(t=>[e(Y,{options:l(U),value:t.row.status},null,8,["options","value"])]),_:1}),e(i,{label:"操作日期",align:"center",prop:"operTime",width:"180",sortable:"custom","sort-orders":["descending","ascending"]},{default:a(t=>[I("span",null,x(l(n).parseTime(t.row.operTime)),1)]),_:1}),e(i,{label:"消耗时间",align:"center",prop:"costTime",width:"110","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]},{default:a(t=>[I("span",null,x(t.row.costTime)+"毫秒",1)]),_:1}),e(i,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:a(t=>[e(ue,{content:"详细",placement:"top"},{default:a(()=>[c(e(_,{link:"",type:"primary",icon:"View",onClick:Ke=>te(t.row)},null,8,["onClick"]),[[T,["monitor:operlog:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data","default-sort"])),[[ce,l(V)]]),c(e(me,{page:l(r).pageNum,"onUpdate:page":o[8]||(o[8]=t=>l(r).pageNum=t),limit:l(r).pageSize,"onUpdate:limit":o[9]||(o[9]=t=>l(r).pageSize=t),total:l(C),onPagination:d},null,8,["page","limit","total"]),[[W,l(C)>0]])]),_:1}),e(qe,{ref_key:"operInfoDialogRef",ref:P},null,512)])}}});export{po as default};
