import{d as X,h as we,i as Ce,r as p,ag as G,ab as Ne,b as Ue,ah as Te,c as J,o as c,m as a,q as n,w as f,p as q,e as t,C as he,D as E,H as Ee,G as g,a6 as W,ai as Se,t as b,x as U,y as Ie,b2 as Pe,$ as $e,v as De,Y as qe,z as Fe,F as Re,A as Be,B as Le,aj as xe,dp as Ke,dq as Ye,dr as ze,ds as Ae,dt as He,du as Me,dv as Qe,dw as je,dx as Oe}from"./index-B9WM9B43.js";/* empty css                  */import{E as Ge}from"./el-date-picker-LQDrgT3l.js";import{_ as Je}from"./index-F9iJ6oEr.js";import{E as We,a as Xe}from"./el-table-column-CfNB-tiT.js";import"./el-checkbox-CIZQMxKL.js";import{E as Ze}from"./el-row-CZ85bKL9.js";import{_ as ea}from"./index-CfXeGV0Q.js";import{E as aa}from"./el-col-DjEila-N.js";import{E as ta}from"./el-card-C9-IEzMj.js";import{a as la,E as na}from"./el-form-item-C52vg3Rn.js";import{s as oa}from"./index-DvFyezMC.js";import"./index-C6vhygJv.js";import"./_initCloneObject-CtNQcUp4.js";import"./el-tree-FBGJd7y4.js";import"./_baseClone-DI-sfL8c.js";const sa={class:"p-2"},da={class:"mb-[10px]"},ra={class:"dialog-footer"},ia=X({name:"Tenant"}),ha=X({...ia,setup(ua){const{proxy:s}=we(),Z=Ce(),F=p(Z.userId),R=p([]),B=p([]),T=p(!1),y=p(!0),h=p(!0),S=p([]),L=p(!0),x=p(!0),I=p(0),K=p(),P=p(),v=G({visible:!1,title:""}),Y={id:void 0,tenantId:void 0,contactUserName:"",contactPhone:"",username:"",password:"",companyName:"",licenseNumber:"",domain:"",address:"",intro:"",remark:"",packageId:"",expireTime:"",accountCount:0,status:"0"},ee=G({form:{...Y},queryParams:{pageNum:1,pageSize:10,tenantId:"",contactUserName:"",contactPhone:"",companyName:""},rules:{id:[{required:!0,message:"id不能为空",trigger:"blur"}],tenantId:[{required:!0,message:"租户编号不能为空",trigger:"blur"}],contactUserName:[{required:!0,message:"联系人不能为空",trigger:"blur"}],contactPhone:[{required:!0,message:"联系电话不能为空",trigger:"blur"}],companyName:[{required:!0,message:"企业名称不能为空",trigger:"blur"}],username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"}]}}),{queryParams:u,form:d,rules:ae}=Ne(ee),z=async()=>{const o=await oa();B.value=o.data},V=async()=>{y.value=!0;const o=await Ke(u.value);R.value=o.rows,I.value=o.total,y.value=!1},te=async o=>{const e=o.status==="0"?"启用":"停用";try{await(s==null?void 0:s.$modal.confirm('确认要"'+e+'""'+o.companyName+'"租户吗？')),await Ye(o.id,o.tenantId,o.status),s==null||s.$modal.msgSuccess(e+"成功")}catch{o.status=o.status==="0"?"1":"0"}},le=()=>{$(),v.visible=!1},$=()=>{var o;d.value={...Y},(o=P.value)==null||o.resetFields()},w=()=>{u.value.pageNum=1,V()},ne=()=>{var o;(o=K.value)==null||o.resetFields(),w()},oe=o=>{S.value=o.map(e=>e.id),L.value=o.length!=1,x.value=!o.length},se=()=>{$(),z(),v.visible=!0,v.title="添加租户"},A=async o=>{$(),await z();const e=(o==null?void 0:o.id)||S.value[0],i=await ze(e);Object.assign(d.value,i.data),v.visible=!0,v.title="修改租户"},de=()=>{var o;(o=P.value)==null||o.validate(async e=>{e&&(T.value=!0,d.value.id?await Ae(d.value).finally(()=>T.value=!1):await He(d.value).finally(()=>T.value=!1),s==null||s.$modal.msgSuccess("操作成功"),v.visible=!1,await V())})},H=async o=>{const e=(o==null?void 0:o.id)||S.value;await(s==null?void 0:s.$modal.confirm('是否确认删除租户编号为"'+e+'"的数据项？')),y.value=!0,await Me(e).finally(()=>y.value=!1),await V(),s==null||s.$modal.msgSuccess("删除成功")},re=async o=>{try{await(s==null?void 0:s.$modal.confirm('是否确认同步租户套餐租户编号为"'+o.tenantId+'"的数据项？')),y.value=!0,await Qe(o.tenantId,o.packageId),await V(),s==null||s.$modal.msgSuccess("同步成功")}catch{return}finally{y.value=!1}},ie=()=>{s==null||s.download("system/tenant/export",{...u.value},`tenant_${new Date().getTime()}.xlsx`)},ue=async()=>{await(s==null?void 0:s.$modal.confirm("确认要同步所有租户字典吗？"));const o=await je();s==null||s.$modal.msgSuccess(o.msg)},me=async()=>{await(s==null?void 0:s.$modal.confirm("确认要同步所有租户参数配置吗？"));const o=await Oe();s==null||s.$modal.msgSuccess(o.msg)};return Ue(()=>{V()}),(o,e)=>{var j,O;const i=he,r=na,m=Ee,M=la,Q=ta,C=aa,pe=ea,ce=Ze,_=Xe,fe=Pe,D=$e,ge=We,be=Je,ve=Le,_e=Fe,ye=Ge,Ve=xe,k=Te("hasPermi"),ke=De;return c(),J("div",sa,[a(Se,{"enter-active-class":(j=t(s))==null?void 0:j.animate.searchAnimate.enter,"leave-active-class":(O=t(s))==null?void 0:O.animate.searchAnimate.leave},{default:n(()=>[f(q("div",da,[a(Q,{shadow:"hover"},{default:n(()=>[a(M,{ref_key:"queryFormRef",ref:K,model:t(u),inline:!0},{default:n(()=>[a(r,{label:"租户编号",prop:"tenantId"},{default:n(()=>[a(i,{modelValue:t(u).tenantId,"onUpdate:modelValue":e[0]||(e[0]=l=>t(u).tenantId=l),placeholder:"请输入租户编号",clearable:"",onKeyup:E(w,["enter"])},null,8,["modelValue"])]),_:1}),a(r,{label:"联系人",prop:"contactUserName"},{default:n(()=>[a(i,{modelValue:t(u).contactUserName,"onUpdate:modelValue":e[1]||(e[1]=l=>t(u).contactUserName=l),placeholder:"请输入联系人",clearable:"",onKeyup:E(w,["enter"])},null,8,["modelValue"])]),_:1}),a(r,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[a(i,{modelValue:t(u).contactPhone,"onUpdate:modelValue":e[2]||(e[2]=l=>t(u).contactPhone=l),placeholder:"请输入联系电话",clearable:"",onKeyup:E(w,["enter"])},null,8,["modelValue"])]),_:1}),a(r,{label:"企业名称",prop:"companyName"},{default:n(()=>[a(i,{modelValue:t(u).companyName,"onUpdate:modelValue":e[3]||(e[3]=l=>t(u).companyName=l),placeholder:"请输入企业名称",clearable:"",onKeyup:E(w,["enter"])},null,8,["modelValue"])]),_:1}),a(r,null,{default:n(()=>[a(m,{type:"primary",icon:"Search",onClick:w},{default:n(()=>e[23]||(e[23]=[g("搜索")])),_:1}),a(m,{icon:"Refresh",onClick:ne},{default:n(()=>e[24]||(e[24]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[W,t(h)]])]),_:1},8,["enter-active-class","leave-active-class"]),a(Q,{shadow:"hover"},{header:n(()=>[a(ce,{gutter:10,class:"mb8"},{default:n(()=>[a(C,{span:1.5},{default:n(()=>[f((c(),b(m,{type:"primary",plain:"",icon:"Plus",onClick:se},{default:n(()=>e[25]||(e[25]=[g("新增")])),_:1})),[[k,["system:tenant:add"]]])]),_:1}),a(C,{span:1.5},{default:n(()=>[f((c(),b(m,{type:"success",plain:"",icon:"Edit",disabled:t(L),onClick:e[4]||(e[4]=l=>A())},{default:n(()=>e[26]||(e[26]=[g("修改")])),_:1},8,["disabled"])),[[k,["system:tenant:edit"]]])]),_:1}),a(C,{span:1.5},{default:n(()=>[f((c(),b(m,{type:"danger",plain:"",icon:"Delete",disabled:t(x),onClick:e[5]||(e[5]=l=>H())},{default:n(()=>e[27]||(e[27]=[g(" 删除 ")])),_:1},8,["disabled"])),[[k,["system:tenant:remove"]]])]),_:1}),a(C,{span:1.5},{default:n(()=>[f((c(),b(m,{type:"warning",plain:"",icon:"Download",onClick:ie},{default:n(()=>e[28]||(e[28]=[g("导出")])),_:1})),[[k,["system:tenant:export"]]])]),_:1}),a(C,{span:1.5},{default:n(()=>[t(F)===1?(c(),b(m,{key:0,type:"success",plain:"",icon:"Refresh",onClick:ue},{default:n(()=>e[29]||(e[29]=[g("同步租户字典")])),_:1})):U("",!0)]),_:1}),a(C,{span:1.5},{default:n(()=>[t(F)===1?(c(),b(m,{key:0,type:"success",plain:"",icon:"Refresh",onClick:me},{default:n(()=>e[30]||(e[30]=[g("同步租户参数配置")])),_:1})):U("",!0)]),_:1}),a(pe,{"show-search":t(h),"onUpdate:showSearch":e[6]||(e[6]=l=>qe(h)?h.value=l:null),onQueryTable:V},null,8,["show-search"])]),_:1})]),default:n(()=>[f((c(),b(ge,{border:"",data:t(R),onSelectionChange:oe},{default:n(()=>[a(_,{type:"selection",width:"55",align:"center"}),U("",!0),a(_,{label:"租户编号",align:"center",prop:"tenantId"}),a(_,{label:"联系人",align:"center",prop:"contactUserName"}),a(_,{label:"联系电话",align:"center",prop:"contactPhone"}),a(_,{label:"企业名称",align:"center",prop:"companyName"}),a(_,{label:"社会信用代码",align:"center",prop:"licenseNumber"}),a(_,{label:"过期时间",align:"center",prop:"expireTime",width:"180"},{default:n(l=>[q("span",null,Ie(t(s).parseTime(l.row.expireTime,"{y}-{m}-{d}")),1)]),_:1}),a(_,{label:"租户状态",align:"center",prop:"status"},{default:n(l=>[a(fe,{modelValue:l.row.status,"onUpdate:modelValue":N=>l.row.status=N,"active-value":"0","inactive-value":"1",onChange:N=>te(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(_,{width:"150",label:"操作",align:"center",fixed:"right","class-name":"small-padding fixed-width"},{default:n(l=>[a(D,{content:"修改",placement:"top"},{default:n(()=>[f(a(m,{link:"",type:"primary",icon:"Edit",onClick:N=>A(l.row)},null,8,["onClick"]),[[k,["system:tenant:edit"]]])]),_:2},1024),a(D,{content:"同步套餐",placement:"top"},{default:n(()=>[f(a(m,{link:"",type:"primary",icon:"Refresh",onClick:N=>re(l.row)},null,8,["onClick"]),[[k,["system:tenant:edit"]]])]),_:2},1024),a(D,{content:"删除",placement:"top"},{default:n(()=>[f(a(m,{link:"",type:"primary",icon:"Delete",onClick:N=>H(l.row)},null,8,["onClick"]),[[k,["system:tenant:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ke,t(y)]]),f(a(be,{page:t(u).pageNum,"onUpdate:page":e[7]||(e[7]=l=>t(u).pageNum=l),limit:t(u).pageSize,"onUpdate:limit":e[8]||(e[8]=l=>t(u).pageSize=l),total:t(I),onPagination:V},null,8,["page","limit","total"]),[[W,t(I)>0]])]),_:1}),a(Ve,{modelValue:t(v).visible,"onUpdate:modelValue":e[22]||(e[22]=l=>t(v).visible=l),title:t(v).title,width:"500px","append-to-body":""},{footer:n(()=>[q("div",ra,[a(m,{loading:t(T),type:"primary",onClick:de},{default:n(()=>e[31]||(e[31]=[g("确 定")])),_:1},8,["loading"]),a(m,{onClick:le},{default:n(()=>e[32]||(e[32]=[g("取 消")])),_:1})])]),default:n(()=>[a(M,{ref_key:"tenantFormRef",ref:P,model:t(d),rules:t(ae),"label-width":"80px"},{default:n(()=>[a(r,{label:"企业名称",prop:"companyName"},{default:n(()=>[a(i,{modelValue:t(d).companyName,"onUpdate:modelValue":e[9]||(e[9]=l=>t(d).companyName=l),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),a(r,{label:"联系人",prop:"contactUserName"},{default:n(()=>[a(i,{modelValue:t(d).contactUserName,"onUpdate:modelValue":e[10]||(e[10]=l=>t(d).contactUserName=l),placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),a(r,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[a(i,{modelValue:t(d).contactPhone,"onUpdate:modelValue":e[11]||(e[11]=l=>t(d).contactPhone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),t(d).id?U("",!0):(c(),b(r,{key:0,label:"用户名",prop:"username"},{default:n(()=>[a(i,{modelValue:t(d).username,"onUpdate:modelValue":e[12]||(e[12]=l=>t(d).username=l),placeholder:"请输入系统用户名",maxlength:"30"},null,8,["modelValue"])]),_:1})),t(d).id?U("",!0):(c(),b(r,{key:1,label:"用户密码",prop:"password"},{default:n(()=>[a(i,{modelValue:t(d).password,"onUpdate:modelValue":e[13]||(e[13]=l=>t(d).password=l),type:"password",placeholder:"请输入系统用户密码",maxlength:"20"},null,8,["modelValue"])]),_:1})),a(r,{label:"租户套餐",prop:"packageId"},{default:n(()=>[a(_e,{modelValue:t(d).packageId,"onUpdate:modelValue":e[14]||(e[14]=l=>t(d).packageId=l),disabled:!!t(d).tenantId,placeholder:"请选择租户套餐",clearable:"",style:{width:"100%"}},{default:n(()=>[(c(!0),J(Re,null,Be(t(B),l=>(c(),b(ve,{key:l.packageId,label:l.packageName,value:l.packageId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(r,{label:"过期时间",prop:"expireTime"},{default:n(()=>[a(ye,{modelValue:t(d).expireTime,"onUpdate:modelValue":e[15]||(e[15]=l=>t(d).expireTime=l),clearable:"",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"请选择过期时间"},null,8,["modelValue"])]),_:1}),a(r,{label:"用户数量",prop:"accountCount"},{default:n(()=>[a(i,{modelValue:t(d).accountCount,"onUpdate:modelValue":e[16]||(e[16]=l=>t(d).accountCount=l),placeholder:"请输入用户数量"},null,8,["modelValue"])]),_:1}),a(r,{label:"绑定域名",prop:"domain"},{default:n(()=>[a(i,{modelValue:t(d).domain,"onUpdate:modelValue":e[17]||(e[17]=l=>t(d).domain=l),placeholder:"请输入绑定域名"},null,8,["modelValue"])]),_:1}),a(r,{label:"企业地址",prop:"address"},{default:n(()=>[a(i,{modelValue:t(d).address,"onUpdate:modelValue":e[18]||(e[18]=l=>t(d).address=l),placeholder:"请输入企业地址"},null,8,["modelValue"])]),_:1}),a(r,{label:"企业代码",prop:"licenseNumber"},{default:n(()=>[a(i,{modelValue:t(d).licenseNumber,"onUpdate:modelValue":e[19]||(e[19]=l=>t(d).licenseNumber=l),placeholder:"请输入统一社会信用代码"},null,8,["modelValue"])]),_:1}),a(r,{label:"企业简介",prop:"intro"},{default:n(()=>[a(i,{modelValue:t(d).intro,"onUpdate:modelValue":e[20]||(e[20]=l=>t(d).intro=l),type:"textarea",placeholder:"请输入企业简介"},null,8,["modelValue"])]),_:1}),a(r,{label:"备注",prop:"remark"},{default:n(()=>[a(i,{modelValue:t(d).remark,"onUpdate:modelValue":e[21]||(e[21]=l=>t(d).remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{ha as default};
