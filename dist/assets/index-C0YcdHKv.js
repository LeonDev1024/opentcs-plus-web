import{a9 as c,d as ue,r as d,ag as ce,b as de,c as V,o as N,m as s,q as a,p as r,R as me,G as o,y,H as pe,F as fe,A as _e,a7 as ve,C as ge,aj as ye,E as i,M as Se}from"./index-B9WM9B43.js";/* empty css                  */import{a as Ee,E as be}from"./el-form-item-C52vg3Rn.js";import{E as Ce,a as we}from"./el-table-column-CfNB-tiT.js";import"./el-checkbox-CIZQMxKL.js";import{E as he,a as ke}from"./el-tab-pane-BQbBlK-W.js";import{E as Ve}from"./el-card-C9-IEzMj.js";import{E as Ne}from"./el-row-CZ85bKL9.js";import{E as Te}from"./el-col-DjEila-N.js";import{E as De}from"./el-statistic-BxYTBkPZ.js";import Pe from"./VehicleStatus-CEhuqSSZ.js";import xe from"./OrderStatus-Do0Y2NL1.js";import Ie from"./TrafficStatus-BiggHRw-.js";import"./_baseClone-DI-sfL8c.js";import"./_initCloneObject-CtNQcUp4.js";const m={start:()=>c({url:"/api/simulation/start",method:"post"}),pause:()=>c({url:"/api/simulation/pause",method:"post"}),resume:()=>c({url:"/api/simulation/resume",method:"post"}),stop:()=>c({url:"/api/simulation/stop",method:"post"}),getStatus:()=>c({url:"/api/simulation/status",method:"get"}),createScene:f=>c({url:"/api/simulation/scene/create",method:"post",data:f}),getScenes:()=>c({url:"/api/simulation/scenes",method:"get"}),setCurrentScene:f=>c({url:`/api/simulation/scene/set-current/${f}`,method:"post"}),addVehicle:f=>c({url:"/api/simulation/vehicle/add",method:"post",data:f}),getVehicles:()=>c({url:"/api/simulation/vehicles",method:"get"}),getOrders:()=>c({url:"/api/simulation/orders",method:"get"})},Re={class:"simulation-container"},Oe={class:"card-header"},Ue={class:"header-actions"},$e={class:"status-info"},ze={class:"card-header"},Ge={class:"header-actions"},Ae={class:"vehicle-label"},Fe={class:"card-header"},Me={class:"dialog-footer"},Be=ue({__name:"index",setup(f){const u=d("STOPPED"),C=d(0),T=d(10),D=d(0),w=d([]),P=d([]),A=d([]),x=d([]),F=d(),p=d(1),S=d(!1),_=ce({name:"",description:""}),M=async()=>{try{const e=await m.start();e.success&&(i.success(e.message),u.value="RUNNING",D.value=Date.now(),ae())}catch{i.error("启动仿真失败")}},B=async()=>{try{const e=await m.pause();e.success&&(i.success(e.message),u.value="PAUSED")}catch{i.error("暂停仿真失败")}},L=async()=>{try{const e=await m.resume();e.success&&(i.success(e.message),u.value="RUNNING")}catch{i.error("继续仿真失败")}},H=async()=>{try{const e=await m.stop();e.success&&(i.success(e.message),u.value="STOPPED",C.value=0)}catch{i.error("停止仿真失败")}},j=e=>{switch(e){case"RUNNING":return"success";case"PAUSED":return"warning";case"STOPPED":return"info";default:return"info"}},q=()=>{if(u.value==="STOPPED")return"00:00:00";const t=Date.now()-D.value,n=Math.floor(t/36e5),h=Math.floor(t%36e5/6e4),v=Math.floor(t%6e4/1e3);return`${n.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},J=()=>{p.value+=.1},K=()=>{p.value>.5&&(p.value-=.1)},Q=()=>{p.value=1},W=e=>({left:`${e.x*10*p.value}px`,top:`${e.y*10*p.value}px`,transform:`rotate(${e.theta*180/Math.PI}deg) scale(${p.value})`,backgroundColor:X(e.state)}),X=e=>{switch(e){case"IDLE":return"#67C23A";case"MOVING":return"#409EFF";case"CHARGING":return"#E6A23C";case"ERROR":return"#F56C6C";default:return"#909399"}},Y=()=>{S.value=!0},Z=async()=>{try{(await m.createScene(_)).success&&(i.success("场景创建成功"),S.value=!1,U())}catch{i.error("创建场景失败")}},ee=async e=>{try{(await m.setCurrentScene(e.name)).success&&i.success("场景设置成功")}catch{i.error("设置场景失败")}},te=e=>{i.success("场景删除成功")},se=e=>new Date(e).toLocaleString(),ae=()=>{setInterval(()=>{I(),R(),O()},1e3)},I=async()=>{try{const e=await m.getVehicles();e.success&&(w.value=e.vehicles)}catch{console.error("加载车辆数据失败")}},R=async()=>{try{const e=await m.getOrders();e.success&&(P.value=e.orders)}catch{console.error("加载订单数据失败")}},O=async()=>{try{const e=await m.getStatus();e.success&&(u.value=e.status,C.value=e.currentTick,T.value=e.tickRate)}catch{console.error("加载仿真状态失败")}},U=async()=>{try{const e=await m.getScenes();e.success&&(x.value=e.scenes)}catch{console.error("加载场景数据失败")}};return de(()=>{U(),I(),R(),O()}),(e,t)=>{const n=pe,h=me,v=De,g=Te,$=Ne,E=Ve,k=ke,oe=he,b=we,le=Ce,z=ge,G=be,ne=Ee,re=ye;return N(),V("div",Re,[s(E,{class:"simulation-header"},{header:a(()=>[r("div",Oe,[t[8]||(t[8]=r("span",null,"AGV 仿真系统",-1)),r("div",Ue,[s(n,{type:"primary",onClick:M,disabled:u.value==="RUNNING"},{default:a(()=>t[4]||(t[4]=[o(" 启动仿真 ")])),_:1},8,["disabled"]),s(n,{onClick:B,disabled:u.value!=="RUNNING"},{default:a(()=>t[5]||(t[5]=[o(" 暂停仿真 ")])),_:1},8,["disabled"]),s(n,{onClick:L,disabled:u.value!=="PAUSED"},{default:a(()=>t[6]||(t[6]=[o(" 继续仿真 ")])),_:1},8,["disabled"]),s(n,{type:"danger",onClick:H,disabled:u.value==="STOPPED"},{default:a(()=>t[7]||(t[7]=[o(" 停止仿真 ")])),_:1},8,["disabled"])])])]),default:a(()=>[r("div",$e,[s($,{gutter:20},{default:a(()=>[s(g,{span:6},{default:a(()=>[s(v,{title:"仿真状态"},{value:a(()=>[s(h,{type:j(u.value)},{default:a(()=>[o(y(u.value),1)]),_:1},8,["type"])]),_:1})]),_:1}),s(g,{span:6},{default:a(()=>[s(v,{title:"当前 Tick"},{value:a(()=>[o(y(C.value),1)]),_:1})]),_:1}),s(g,{span:6},{default:a(()=>[s(v,{title:"仿真速率"},{value:a(()=>[o(y(T.value)+" ticks/秒",1)]),_:1})]),_:1}),s(g,{span:6},{default:a(()=>[s(v,{title:"运行时间"},{value:a(()=>[o(y(q()),1)]),_:1})]),_:1})]),_:1})])]),_:1}),s($,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[s(g,{span:16},{default:a(()=>[s(E,{class:"simulation-map"},{header:a(()=>[r("div",ze,[t[12]||(t[12]=r("span",null,"仿真地图",-1)),r("div",Ge,[s(n,{size:"small",onClick:J},{default:a(()=>t[9]||(t[9]=[o("放大")])),_:1}),s(n,{size:"small",onClick:K},{default:a(()=>t[10]||(t[10]=[o("缩小")])),_:1}),s(n,{size:"small",onClick:Q},{default:a(()=>t[11]||(t[11]=[o("重置视图")])),_:1})])])]),default:a(()=>[r("div",{class:"map-container",ref_key:"mapContainer",ref:F},[t[13]||(t[13]=r("div",{class:"map-background"},null,-1)),(N(!0),V(fe,null,_e(w.value,l=>(N(),V("div",{key:l.vehicleId,class:"vehicle",style:ve(W(l))},[r("div",Ae,y(l.name),1)],4))),128))],512)]),_:1})]),_:1}),s(g,{span:8},{default:a(()=>[s(E,{class:"simulation-stats"},{header:a(()=>t[14]||(t[14]=[r("span",null,"仿真统计",-1)])),default:a(()=>[s(oe,{type:"border-card"},{default:a(()=>[s(k,{label:"车辆状态"},{default:a(()=>[s(Pe,{vehicles:w.value},null,8,["vehicles"])]),_:1}),s(k,{label:"订单状态"},{default:a(()=>[s(xe,{orders:P.value},null,8,["orders"])]),_:1}),s(k,{label:"交通冲突"},{default:a(()=>[s(Ie,{conflicts:A.value},null,8,["conflicts"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(E,{class:"simulation-scene",style:{"margin-top":"20px"}},{header:a(()=>[r("div",Fe,[t[16]||(t[16]=r("span",null,"仿真场景管理",-1)),s(n,{type:"primary",size:"small",onClick:Y},{default:a(()=>t[15]||(t[15]=[o(" 创建场景 ")])),_:1})])]),default:a(()=>[s(le,{data:x.value,style:{width:"100%"}},{default:a(()=>[s(b,{prop:"name",label:"场景名称",width:"180"}),s(b,{prop:"description",label:"场景描述"}),s(b,{prop:"creationTime",label:"创建时间",width:"180"},{default:a(l=>[o(y(se(l.row.creationTime)),1)]),_:1}),s(b,{label:"操作",width:"150"},{default:a(l=>[s(n,{size:"small",onClick:ie=>ee(l.row)},{default:a(()=>t[17]||(t[17]=[o(" 选择 ")])),_:2},1032,["onClick"]),s(n,{size:"small",type:"danger",onClick:ie=>te(l.row)},{default:a(()=>t[18]||(t[18]=[o(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),s(re,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=l=>S.value=l),title:"创建仿真场景",width:"500px"},{footer:a(()=>[r("span",Me,[s(n,{onClick:t[2]||(t[2]=l=>S.value=!1)},{default:a(()=>t[19]||(t[19]=[o("取消")])),_:1}),s(n,{type:"primary",onClick:Z},{default:a(()=>t[20]||(t[20]=[o("确定")])),_:1})])]),default:a(()=>[s(ne,{model:_,"label-width":"80px"},{default:a(()=>[s(G,{label:"场景名称"},{default:a(()=>[s(z,{modelValue:_.name,"onUpdate:modelValue":t[0]||(t[0]=l=>_.name=l),placeholder:"请输入场景名称"},null,8,["modelValue"])]),_:1}),s(G,{label:"场景描述"},{default:a(()=>[s(z,{modelValue:_.description,"onUpdate:modelValue":t[1]||(t[1]=l=>_.description=l),type:"textarea",placeholder:"请输入场景描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ot=Se(Be,[["__scopeId","data-v-f76ba50a"]]);export{ot as default};
