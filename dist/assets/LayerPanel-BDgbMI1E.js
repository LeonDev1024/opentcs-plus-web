import{d as H,r as b,N as h,k as j,c as z,o as L,m as l,q as i,p,a0 as F,H as J,I as g,t as K,R as O,G as Q,y as W,a8 as _,E as y,M as X}from"./index-B9WM9B43.js";import{E as Y,a as ee}from"./el-tab-pane-BQbBlK-W.js";import{E as ae,a as te}from"./el-table-column-CfNB-tiT.js";import{E as le}from"./el-checkbox-CIZQMxKL.js";import{E as ne}from"./el-radio-Cy5OMmSA.js";import{u as oe}from"./mapEditor-C3208Y0J.js";import"./_initCloneObject-CtNQcUp4.js";import"./index-BJgmA4Qg.js";const se={class:"layer-panel"},ie={class:"layer-content"},re={class:"layer-toolbar"},de={class:"layer-table-wrapper"},ce={key:1,style:{color:"#909399","font-size":"12px"}},ue={class:"layers-group-content"},pe={class:"layer-group-toolbar"},me={class:"layer-group-table-wrapper"},ye=H({__name:"LayerPanel",setup(ve){const n=oe(),x=b("layers"),s=b(null),d=b(null),c=h(()=>[...n.layers].sort((e,a)=>a.zIndex-e.zIndex)),G=h(()=>n.layerGroups),V=h(()=>n.activeLayerId),C=e=>{if(!e)return null;const a=n.layerGroups.find(t=>t.id===e);return(a==null?void 0:a.name)||null},I=e=>{s.value=e},B=e=>{const a=V.value;return!a||!e?!1:String(a)===String(e)},f=e=>{n.setActiveLayer(e),s.value=e},M=e=>{I(e.id)},T=e=>{n.updateLayer(e.id,{visible:e.visible})},S=()=>{_.prompt("请输入图层名称","添加图层",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"图层名称不能为空"}).then(({value:e})=>{const a=n.addLayer({name:e,type:"point",visible:!0,locked:!1,zIndex:n.layers.length+1,opacity:1,elementIds:[]});f(a.id),I(a.id),y.success("添加成功")}).catch(()=>{})},A=async()=>{if(s.value)try{await _.confirm("确定要删除该图层吗？图层中的所有元素也将被删除。","提示",{type:"warning"}),n.deleteLayer(s.value),y.success("删除成功"),s.value=null}catch{}},P=()=>{if(!s.value)return;const e=n.layers.find(t=>t.id===s.value);if(!e)return;const a=c.value.findIndex(t=>t.id===e.id);if(a>0){const t=c.value[a-1],r=e.zIndex;n.updateLayer(e.id,{zIndex:t.zIndex}),n.updateLayer(t.id,{zIndex:r})}},U=()=>{if(!s.value)return;const e=n.layers.find(t=>t.id===s.value);if(!e)return;const a=c.value.findIndex(t=>t.id===e.id);if(a<c.value.length-1){const t=c.value[a+1],r=e.zIndex;n.updateLayer(e.id,{zIndex:t.zIndex}),n.updateLayer(t.id,{zIndex:r})}},D=e=>{d.value=e.id},R=e=>{n.updateLayerGroup(e.id,{visible:e.visible})},N=()=>{_.prompt("请输入图层组名称","添加图层组",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"图层组名称不能为空"}).then(({value:e})=>{const a=n.addLayerGroup({name:e,visible:!0});d.value=a.id,y.success("添加成功")}).catch(()=>{})},Z=async()=>{if(d.value)try{await _.confirm("确定要删除该图层组吗？","提示",{type:"warning"}),n.deleteLayerGroup(d.value),y.success("删除成功"),d.value=null}catch(e){e&&e!=="cancel"&&y.error(e.message||"删除失败")}};return j(()=>[n.layers,n.activeLayerId],([e,a])=>{if(e.length>0&&!(a&&e.some(r=>String(r.id)===String(a)))){const r=e.find(v=>v.name==="Default layer"||v.name==="默认图层")||e[0];r&&f(r.id)}},{immediate:!0}),(e,a)=>{const t=J,r=F,v=ne,u=te,w=le,$=O,E=ae,k=ee,q=Y;return L(),z("div",se,[l(q,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=o=>x.value=o),class:"layer-tabs"},{default:i(()=>[l(k,{label:"图层",name:"layers"},{default:i(()=>[p("div",ie,[p("div",re,[l(r,{size:"small"},{default:i(()=>[l(t,{icon:"Plus",onClick:S,title:"添加图层"}),l(t,{icon:"Minus",onClick:A,disabled:!s.value,title:"删除图层"},null,8,["disabled"]),l(t,{icon:"ArrowUp",onClick:P,disabled:!s.value,title:"上移"},null,8,["disabled"]),l(t,{icon:"ArrowDown",onClick:U,disabled:!s.value,title:"下移"},null,8,["disabled"])]),_:1})]),p("div",de,[l(E,{data:c.value,border:"",size:"small",style:{width:"100%"},onRowClick:M,"highlight-current-row":""},{default:i(()=>[l(u,{width:"60",align:"center",label:"激活"},{default:i(({row:o})=>[l(v,{"model-value":B(o.id),onClick:a[0]||(a[0]=g(()=>{},["stop"])),onChange:()=>f(o.id)},null,8,["model-value","onChange"])]),_:1}),l(u,{width:"60",align:"center",label:"可见"},{default:i(({row:o})=>[l(w,{modelValue:o.visible,"onUpdate:modelValue":m=>o.visible=m,onClick:a[1]||(a[1]=g(()=>{},["stop"])),onChange:m=>T(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(u,{prop:"name",label:"名称","min-width":"120"}),l(u,{prop:"layerGroupId",label:"图层组",width:"120"},{default:i(({row:o})=>[C(o.layerGroupId)?(L(),K($,{key:0,size:"small"},{default:i(()=>[Q(W(C(o.layerGroupId)),1)]),_:2},1024)):(L(),z("span",ce,"未分组"))]),_:1})]),_:1},8,["data"])])])]),_:1}),l(k,{label:"图层组",name:"layersgroup"},{default:i(()=>[p("div",ue,[p("div",pe,[l(r,{size:"small"},{default:i(()=>[l(t,{icon:"Plus",onClick:N,title:"添加图层组"}),l(t,{icon:"Minus",onClick:Z,disabled:!d.value,title:"删除图层组"},null,8,["disabled"])]),_:1})]),p("div",me,[l(E,{data:G.value,border:"",size:"small",style:{width:"100%"},onRowClick:D,"highlight-current-row":""},{default:i(()=>[l(u,{width:"60",align:"center",label:"可见"},{default:i(({row:o})=>[l(w,{modelValue:o.visible,"onUpdate:modelValue":m=>o.visible=m,onClick:a[2]||(a[2]=g(()=>{},["stop"])),onChange:m=>R(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(u,{prop:"name",label:"名称","min-width":"150"})]),_:1},8,["data"])])])]),_:1})]),_:1},8,["modelValue"])])}}}),Ie=X(ye,[["__scopeId","data-v-9bdcf93c"]]);export{Ie as default};
