import{d as J,r as k,N as K,c as M,o as b,m,q as v,p,I as $,t as C,x as B,S as O,e as U,at as Q,au as Z,y as ee,ae as te,M as ne}from"./index-B9WM9B43.js";import{E as oe,a as le}from"./el-tab-pane-BQbBlK-W.js";import{E as se}from"./el-tree-FBGJd7y4.js";import"./el-checkbox-CIZQMxKL.js";import{E as ie}from"./el-radio-Cy5OMmSA.js";import{u as de}from"./mapEditor-C3208Y0J.js";import ae from"./PointDetailDialog-BfXcF0ul.js";import re from"./PointEditDialog-B41o9-gh.js";import"./index-BJgmA4Qg.js";/* empty css                  */import"./el-descriptions-item-BMqIgY0I.js";import"./el-form-item-C52vg3Rn.js";import"./_baseClone-DI-sfL8c.js";import"./_initCloneObject-CtNQcUp4.js";import"./el-input-number-CWw6lCGD.js";import"./index-C6vhygJv.js";const ce={class:"components-panel"},me={class:"components-content"},pe={class:"components-tree"},ue=["onDblclick","onContextmenu"],fe={key:2,class:"tree-element-icon path-icon"},ye={class:"node-label"},ve={class:"blocks-content"},_e=J({__name:"ComponentsPanel",setup(be){const l=de(),I=k("components"),x=k(!1),E=k(!1),h=k(null),z={children:"children",label:"label"},F=K(()=>{var P,N,D,V;const n=[],s={id:"layout",label:((N=(P=l.mapData)==null?void 0:P.visualLayout)==null?void 0:N.name)||((V=(D=l.mapData)==null?void 0:D.mapInfo)==null?void 0:V.name)||"Layout VLayout-01",type:"layout",children:[]},o={id:"points-folder",label:"Points",type:"folder",children:l.points.map(e=>({id:e.id,label:e.name||e.id,type:"element",elementType:"point",elementId:e.id}))};s.children.push(o);const d=e=>{if(e==null)return"";const f=String(e),c=l.points.find(g=>String(g.id)===f);return c?c.name||c.id:f},a=e=>{const f=d(e.startPointId),c=d(e.endPointId);return f&&c?e.name||`Path ${f} --- ${c}`:e.name||e.id},_=l.paths,r=l.layerGroups.find(e=>e.name==="Links"),i=r==null?void 0:r.id,y=[],T=[];_.forEach(e=>{var S,w;const f=((S=e.name)==null?void 0:S.startsWith("Link"))||((w=e.name)==null?void 0:w.startsWith("link")),c=l.layers.find(A=>A.id===e.layerId),g=c&&c.layerGroupId===i;f||g?y.push(e):T.push(e)});const X={id:"paths-folder",label:"Paths",type:"folder",children:T.map(e=>({id:e.id,label:a(e),type:"element",elementType:"path",elementId:e.id}))};s.children.push(X);const Y={id:"locations-folder",label:"Locations",type:"folder",children:l.locations.map(e=>({id:e.id,label:e.name||e.id,type:"element",elementType:"location",elementId:e.id}))};s.children.push(Y);const j={id:"links-folder",label:"Links",type:"folder",children:y.map(e=>({id:e.id,label:a(e),type:"element",elementType:"path",elementId:e.id}))};return s.children.push(j),n.push(s),n}),q=(n,t)=>l.selection.selectedIds.has(n)&&l.selection.selectedType===t,G=n=>{n.type==="element"&&L(n.elementId,n.elementType)},L=(n,t)=>{l.selectElement(n,t,!1)},W=n=>{if(n.type==="element"&&n.elementType==="point"){const t=l.points.find(s=>s.id===n.elementId);t&&(h.value=t,x.value=!0)}},H=(n,t)=>{if(t.type==="element"&&t.elementType==="point"){const s=l.points.find(u=>u.id===t.elementId);if(s){const u=document.querySelector(".point-context-menu");u&&document.body.removeChild(u);const o=document.createElement("div");o.className="point-context-menu",o.innerHTML='<div class="menu-item">编辑</div>',o.style.cssText=`
        position: fixed;
        left: ${n.clientX}px;
        top: ${n.clientY}px;
        background: #fff;
        border: 1px solid #e4e7ed;
        border-radius: 4px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        z-index: 9999;
        min-width: 120px;
        padding: 4px 0;
      `;const d=o.querySelector(".menu-item");d.style.cssText=`
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        color: #606266;
        transition: background-color 0.2s;
      `,d.addEventListener("mouseenter",()=>{d.style.backgroundColor="#f5f7fa"}),d.addEventListener("mouseleave",()=>{d.style.backgroundColor="transparent"}),d.addEventListener("click",()=>{h.value=s,E.value=!0,document.body.contains(o)&&document.body.removeChild(o),document.removeEventListener("click",a),document.removeEventListener("contextmenu",a)}),document.body.appendChild(o);const a=_=>{o.contains(_.target)||(document.body.contains(o)&&document.body.removeChild(o),document.removeEventListener("click",a),document.removeEventListener("contextmenu",a))};setTimeout(()=>{document.addEventListener("click",a),document.addEventListener("contextmenu",a)},0)}}},R=()=>{};return(n,t)=>{const s=O,u=ie,o=se,d=le,a=te,_=oe;return b(),M("div",ce,[m(_,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=r=>I.value=r),class:"components-tabs"},{default:v(()=>[m(d,{label:"模型元素",name:"components"},{default:v(()=>[p("div",me,[p("div",pe,[m(o,{data:F.value,props:z,"node-key":"id","default-expand-all":!0,"highlight-current":!0,onNodeClick:G},{default:v(({node:r,data:i})=>[p("div",{class:"tree-node",onDblclick:y=>W(i),onContextmenu:$(y=>H(y,i),["prevent"])},[i.type==="layout"?(b(),C(s,{key:0,class:"node-icon"},{default:v(()=>[m(U(Q))]),_:1})):i.type==="folder"?(b(),C(s,{key:1,class:"node-icon"},{default:v(()=>[m(U(Z))]),_:1})):i.type==="element"&&i.elementType==="path"?(b(),M("span",fe,t[4]||(t[4]=[p("svg",{viewBox:"0 0 24 24"},[p("line",{x1:"4",y1:"12",x2:"18",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}),p("polygon",{points:"18,8 22,12 18,16",fill:"currentColor"})],-1)]))):B("",!0),i.type==="element"?(b(),C(u,{key:3,"model-value":q(i.elementId,i.elementType),onClick:t[0]||(t[0]=$(()=>{},["stop"])),onChange:y=>L(i.elementId,i.elementType),class:"element-radio"},null,8,["model-value","onChange"])):B("",!0),p("span",ye,ee(r.label),1)],40,ue)]),_:1},8,["data"])])])]),_:1}),m(d,{label:"区域规则",name:"blocks"},{default:v(()=>[p("div",ve,[m(a,{description:"区域规则功能待实现","image-size":100})])]),_:1})]),_:1},8,["modelValue"]),m(ae,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=r=>x.value=r),point:h.value},null,8,["modelValue","point"]),m(re,{modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=r=>E.value=r),point:h.value,onUpdated:R},null,8,["modelValue","point"])])}}}),Be=ne(_e,[["__scopeId","data-v-4388d594"]]);export{Be as default};
