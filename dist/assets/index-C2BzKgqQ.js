import{a9 as G,d as le,aa as ue,r as _,ab as _e,c as R,o as m,a7 as ke,e as t,m as l,C as ve,Y as X,q as o,_ as fe,ac as Se,ad as xe,p as C,x as Ae,F as Z,A as ee,t as N,a4 as Pe,$ as ye,ae as Ne,w as V,a6 as J,af as de,M as be,h as Re,ag as me,b as Fe,ah as Ie,D as De,H as Ue,G as L,ai as $e,R as ze,y as ce,v as qe,z as Ge,B as He,aj as Be}from"./index-B9WM9B43.js";/* empty css                  */import{E as Ye}from"./el-card-C9-IEzMj.js";import{_ as je}from"./index-F9iJ6oEr.js";import{E as Je,a as Ke}from"./el-table-column-CfNB-tiT.js";import"./el-checkbox-CIZQMxKL.js";import{E as Me}from"./el-row-CZ85bKL9.js";import{_ as Qe}from"./index-CfXeGV0Q.js";import{E as We}from"./el-col-DjEila-N.js";import{a as Xe,E as Ze}from"./el-form-item-C52vg3Rn.js";import{_ as el,a as ll}from"./caret-top-N889OlY-.js";import"./_initCloneObject-CtNQcUp4.js";import"./el-tree-FBGJd7y4.js";import"./_baseClone-DI-sfL8c.js";const tl=y=>G({url:"/map/locationType/list",method:"get",params:y}),ol=y=>G({url:"/map/locationType/"+y,method:"get"}),al=y=>G({url:"/map/locationType/create",method:"post",data:y}),nl=y=>G({url:"/map/locationType/update",method:"put",data:y}),sl=y=>G({url:"/map/locationType/"+y,method:"delete"}),il={class:"icon-list"},rl=["onClick"],pl={key:0,class:"empty-tip"},ul=le({__name:"index",props:{modelValue:ue.string.isRequired,width:ue.string.def("400px")},emits:["update:modelValue"],setup(y,{emit:v}){const H=y,I=v,f=_(!1),{modelValue:h,width:D}=_e(H),k=_([]),F=_([]),T=_(""),B=Object.assign({"/src/assets/location/bettery.svg":()=>de(()=>import("./bettery-BYVaIT8x.js"),[]),"/src/assets/location/transfer.svg":()=>de(()=>import("./transfer-B88XYD46.js"),[])}),S=[];for(const E in B){const d=E.match(/location[\/\\]([^\/\\]+)\.svg$/);d&&d[1]&&S.push(d[1])}F.value=S.sort(),k.value=S,console.log("Location icons loaded:",S);const w=()=>{T.value?k.value=F.value.filter(E=>E.toLowerCase().includes(T.value.toLowerCase())):k.value=F.value},Y=E=>{I("update:modelValue",E),f.value=!1};return(E,d)=>{const U=fe,j=ve,O=el,n=ll,K=ye,x=Ne,M=xe,$=Se;return m(),R("div",{class:"relative",style:ke({width:t(D)})},[l(j,{modelValue:t(h),"onUpdate:modelValue":d[0]||(d[0]=c=>X(h)?h.value=c:null),readonly:"",placeholder:"点击选择图标",onClick:d[1]||(d[1]=c=>f.value=!t(f))},{prepend:o(()=>[l(U,{"icon-class":t(h)},null,8,["icon-class"])]),_:1},8,["modelValue"]),l($,{shadow:"none",visible:t(f),placement:"bottom-end",trigger:"click",width:450},{reference:o(()=>[C("div",{class:"cursor-pointer text-[#999] absolute right-[10px] top-0 height-[32px] leading-[32px]",onClick:d[2]||(d[2]=c=>f.value=!t(f))},[V(l(O,null,null,512),[[J,t(f)]]),V(l(n,null,null,512),[[J,!t(f)]])])]),default:o(()=>[l(j,{modelValue:t(T),"onUpdate:modelValue":d[3]||(d[3]=c=>X(T)?T.value=c:null),class:"p-2",placeholder:"搜索图标",clearable:"",onInput:w},null,8,["modelValue"]),l(M,{height:"w-[200px]"},{default:o(()=>[C("ul",il,[(m(!0),R(Z,null,ee(t(k),(c,Q)=>(m(),N(K,{key:Q,content:c,placement:"bottom",effect:"light"},{default:o(()=>[C("li",{class:Pe(["icon-item",{active:t(h)==c}]),onClick:te=>Y(c)},[l(U,{color:"var(--el-text-color-regular)","icon-class":c,style:{"font-size":"24px"}},null,8,["icon-class"])],10,rl)]),_:2},1032,["content"]))),128))]),t(k).length===0?(m(),R("div",pl,[l(x,{description:"未找到匹配的图标","image-size":80})])):Ae("",!0)]),_:1})]),_:1},8,["visible"])],4)}}}),dl=be(ul,[["__scopeId","data-v-8d61440c"]]),ml={class:"p-2"},cl={class:"search"},_l={key:1,style:{color:"#909399"}},vl={class:"dialog-footer"},fl=le({name:"Location"}),yl=le({...fl,setup(y){const{proxy:v}=Re(),H=_([]),I=_(!1),f=_(!0),h=_(!0),D=_([]),k=_(!0),F=_(!0),T=_(0),B=_(),S=_(),w=me({visible:!1,title:""}),Y=a=>!a||!Array.isArray(a)?[]:a.map(e=>e.name).filter(e=>e),E=a=>!a||!Array.isArray(a)?[]:a.map(e=>e.name).filter(e=>e),d=a=>{if(!a||!Array.isArray(a))return null;for(const e of a){if(e.name==="symbol"||e.name==="Symbol")return e.value||null;if(e.symbol)return e.symbol;if(e.Symbol)return e.Symbol}return null},U={id:void 0,name:void 0,allowedOperations:void 0,allowedPeripheralOperations:void 0,properties:void 0,allowedOperationsList:[],allowedPeripheralOperationsList:[],symbol:"",propertiesText:""},j=me({form:{...U},queryParams:{pageNum:1,pageSize:10,name:void 0},rules:{name:[{required:!0,message:"位置类型名称不能为空",trigger:"blur"}]}}),{queryParams:O,form:n,rules:K}=_e(j),x=async()=>{f.value=!0;const a=await tl(O.value);H.value=a.rows,T.value=a.total,f.value=!1},M=()=>{$(),w.visible=!1},$=()=>{var a;n.value={...U},(a=S.value)==null||a.resetFields()},c=()=>{O.value.pageNum=1,x()},Q=()=>{var a;(a=B.value)==null||a.resetFields(),c()},te=a=>{D.value=a.map(e=>e.id),k.value=a.length!=1,F.value=!a.length},ge=()=>{$(),w.visible=!0,w.title="添加位置类型"},oe=async a=>{$();const e=(a==null?void 0:a.id)||D.value[0],i=(await ol(e)).data;if(n.value.id=i.id,n.value.name=i.name,n.value.allowedOperationsList=E(i.allowedOperations),n.value.allowedPeripheralOperationsList=E(i.allowedPeripheralOperations),i.properties&&Array.isArray(i.properties)){const u=i.properties.find(r=>r.name==="symbol"||r.name==="Symbol");if(n.value.symbol=(u==null?void 0:u.value)||"",!n.value.symbol){const r=i.properties.find(b=>b.symbol||b.Symbol);n.value.symbol=(r==null?void 0:r.symbol)||(r==null?void 0:r.Symbol)||""}const p=i.properties.filter(r=>{const b=r.name||"";return b!=="symbol"&&b!=="Symbol"&&!("symbol"in r)&&!("Symbol"in r)});n.value.propertiesText=p.length>0?JSON.stringify(p,null,2):""}else n.value.symbol="",n.value.propertiesText="";w.visible=!0,w.title="修改位置类型"},we=()=>{var a;(a=S.value)==null||a.validate(async e=>{if(e){I.value=!0;const A={id:n.value.id,name:n.value.name,allowedOperations:n.value.allowedOperationsList.map(p=>({name:p})),allowedPeripheralOperations:n.value.allowedPeripheralOperationsList.map(p=>({name:p}))},i=[];if(n.value.propertiesText&&n.value.propertiesText.trim())try{const p=JSON.parse(n.value.propertiesText);Array.isArray(p)?i.push(...p):typeof p=="object"&&p!==null&&i.push(p)}catch{}n.value.symbol&&i.push({name:"symbol",value:n.value.symbol});const u=i.filter(p=>Object.values(p).some(b=>!(b==null||typeof b=="string"&&b.trim()==="")));A.properties=u.length>0?u:void 0;try{n.value.id?await nl(A):await al(A),v==null||v.$modal.msgSuccess("操作成功"),w.visible=!1,await x()}finally{I.value=!1}}})},ae=async a=>{const e=(a==null?void 0:a.id)||D.value;await(v==null?void 0:v.$modal.confirm('是否确认删除位置类型编号为"'+e+'"的数据项？').finally(()=>f.value=!1)),await sl(e),v==null||v.$modal.msgSuccess("删除成功"),await x()};return Fe(()=>{x()}),(a,e)=>{var re,pe;const A=ve,i=Ze,u=Ue,p=Xe,r=We,b=Qe,Oe=Me,P=Ke,ne=ze,he=fe,se=ye,Ve=Je,Te=je,Ee=Ye,g=He,ie=Ge,Le=Be,z=Ie("hasPermi"),Ce=qe;return m(),R("div",ml,[l($e,{"enter-active-class":(re=t(v))==null?void 0:re.animate.searchAnimate.enter,"leave-active-class":(pe=t(v))==null?void 0:pe.animate.searchAnimate.leave},{default:o(()=>[V(C("div",cl,[l(p,{ref_key:"queryFormRef",ref:B,model:t(O),inline:!0,"label-width":"100px"},{default:o(()=>[l(i,{label:"位置类型名称",prop:"name"},{default:o(()=>[l(A,{modelValue:t(O).name,"onUpdate:modelValue":e[0]||(e[0]=s=>t(O).name=s),placeholder:"请输入位置类型名称",clearable:"",onKeyup:De(c,["enter"])},null,8,["modelValue"])]),_:1}),l(i,null,{default:o(()=>[l(u,{type:"primary",icon:"Search",onClick:c},{default:o(()=>e[12]||(e[12]=[L("搜索")])),_:1}),l(u,{icon:"Refresh",onClick:Q},{default:o(()=>e[13]||(e[13]=[L("重置")])),_:1})]),_:1})]),_:1},8,["model"])],512),[[J,t(h)]])]),_:1},8,["enter-active-class","leave-active-class"]),l(Ee,{shadow:"never"},{header:o(()=>[l(Oe,{gutter:10,class:"mb8"},{default:o(()=>[l(r,{span:1.5},{default:o(()=>[V((m(),N(u,{type:"primary",plain:"",icon:"Plus",onClick:ge},{default:o(()=>e[14]||(e[14]=[L("新增")])),_:1})),[[z,["opentcs:locationType:add"]]])]),_:1}),l(r,{span:1.5},{default:o(()=>[V((m(),N(u,{type:"success",plain:"",icon:"Edit",disabled:t(k),onClick:e[1]||(e[1]=s=>oe())},{default:o(()=>e[15]||(e[15]=[L(" 修改 ")])),_:1},8,["disabled"])),[[z,["opentcs:locationType:edit"]]])]),_:1}),l(r,{span:1.5},{default:o(()=>[V((m(),N(u,{type:"danger",plain:"",icon:"Delete",disabled:t(F),onClick:e[2]||(e[2]=s=>ae())},{default:o(()=>e[16]||(e[16]=[L(" 删除 ")])),_:1},8,["disabled"])),[[z,["opentcs:locationType:remove"]]])]),_:1}),l(b,{"show-search":t(h),"onUpdate:showSearch":e[3]||(e[3]=s=>X(h)?h.value=s:null),onQueryTable:x},null,8,["show-search"])]),_:1})]),default:o(()=>[V((m(),N(Ve,{data:t(H),border:"",onSelectionChange:te},{default:o(()=>[l(P,{type:"selection",width:"55",align:"center"}),l(P,{label:"id",align:"center",prop:"id",width:"80"}),l(P,{label:"位置类型名称",align:"center",prop:"name","min-width":"150"}),l(P,{label:"允许的操作",align:"center",prop:"allowedOperations","min-width":"150","show-overflow-tooltip":""},{default:o(s=>[(m(!0),R(Z,null,ee(Y(s.row.allowedOperations),(q,W)=>(m(),N(ne,{key:W,size:"small",style:{"margin-right":"4px"}},{default:o(()=>[L(ce(q),1)]),_:2},1024))),128))]),_:1}),l(P,{label:"允许的外设操作",align:"center",prop:"allowedPeripheralOperations","min-width":"150","show-overflow-tooltip":""},{default:o(s=>[(m(!0),R(Z,null,ee(Y(s.row.allowedPeripheralOperations),(q,W)=>(m(),N(ne,{key:W,size:"small",type:"info",style:{"margin-right":"4px"}},{default:o(()=>[L(ce(q),1)]),_:2},1024))),128))]),_:1}),l(P,{label:"工作站图标",align:"center","min-width":"100"},{default:o(s=>[d(s.row.properties)?(m(),N(he,{key:0,"icon-class":d(s.row.properties),style:{"font-size":"20px"}},null,8,["icon-class"])):(m(),R("span",_l,"-"))]),_:1}),l(P,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(P,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},{default:o(s=>[l(se,{content:"修改",placement:"top"},{default:o(()=>[V(l(u,{link:"",type:"primary",icon:"Edit",onClick:q=>oe(s.row)},null,8,["onClick"]),[[z,["opentcs:locationType:edit"]]])]),_:2},1024),l(se,{content:"删除",placement:"top"},{default:o(()=>[V(l(u,{link:"",type:"primary",icon:"Delete",onClick:q=>ae(s.row)},null,8,["onClick"]),[[z,["opentcs:locationType:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ce,t(f)]]),V(l(Te,{page:t(O).pageNum,"onUpdate:page":e[4]||(e[4]=s=>t(O).pageNum=s),limit:t(O).pageSize,"onUpdate:limit":e[5]||(e[5]=s=>t(O).pageSize=s),total:t(T),onPagination:x},null,8,["page","limit","total"]),[[J,t(T)>0]])]),_:1}),l(Le,{modelValue:t(w).visible,"onUpdate:modelValue":e[11]||(e[11]=s=>t(w).visible=s),title:t(w).title,width:"600px","append-to-body":""},{footer:o(()=>[C("div",vl,[l(u,{loading:t(I),type:"primary",onClick:we},{default:o(()=>e[21]||(e[21]=[L("确 定")])),_:1},8,["loading"]),l(u,{onClick:M},{default:o(()=>e[22]||(e[22]=[L("取 消")])),_:1})])]),default:o(()=>[l(p,{ref_key:"locationFormRef",ref:S,model:t(n),rules:t(K),"label-width":"140px"},{default:o(()=>[l(i,{label:"位置类型名称",prop:"name"},{default:o(()=>[l(A,{modelValue:t(n).name,"onUpdate:modelValue":e[6]||(e[6]=s=>t(n).name=s),placeholder:"请输入位置类型名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"允许的操作",prop:"allowedOperations"},{default:o(()=>[l(ie,{modelValue:t(n).allowedOperationsList,"onUpdate:modelValue":e[7]||(e[7]=s=>t(n).allowedOperationsList=s),multiple:"",placeholder:"请选择允许的操作",style:{width:"100%"}},{default:o(()=>[l(g,{label:"LOAD",value:"LOAD"}),l(g,{label:"UNLOAD",value:"UNLOAD"}),l(g,{label:"NOP",value:"NOP"}),l(g,{label:"MOVE",value:"MOVE"}),l(g,{label:"PARK",value:"PARK"}),l(g,{label:"CHARGE",value:"CHARGE"})]),_:1},8,["modelValue"]),e[17]||(e[17]=C("div",{class:"form-tip"},"选择该位置类型支持的小车动作",-1))]),_:1}),l(i,{label:"允许的外设操作",prop:"allowedPeripheralOperations"},{default:o(()=>[l(ie,{modelValue:t(n).allowedPeripheralOperationsList,"onUpdate:modelValue":e[8]||(e[8]=s=>t(n).allowedPeripheralOperationsList=s),multiple:"",placeholder:"请选择允许的外设操作",style:{width:"100%"}},{default:o(()=>[l(g,{label:"LIFT_UP",value:"LIFT_UP"}),l(g,{label:"LIFT_DOWN",value:"LIFT_DOWN"}),l(g,{label:"CONVEYOR_START",value:"CONVEYOR_START"}),l(g,{label:"CONVEYOR_STOP",value:"CONVEYOR_STOP"}),l(g,{label:"LIGHT_ON",value:"LIGHT_ON"}),l(g,{label:"LIGHT_OFF",value:"LIGHT_OFF"})]),_:1},8,["modelValue"]),e[18]||(e[18]=C("div",{class:"form-tip"},"选择该位置类型支持的外设动作",-1))]),_:1}),l(i,{label:"工作站图标",prop:"symbol"},{default:o(()=>[l(dl,{modelValue:t(n).symbol,"onUpdate:modelValue":e[9]||(e[9]=s=>t(n).symbol=s)},null,8,["modelValue"]),e[19]||(e[19]=C("div",{class:"form-tip"},"选择 assets/location 目录下的图标，用于在地图上显示该位置类型的标识",-1))]),_:1}),l(i,{label:"其他参数",prop:"properties"},{default:o(()=>[l(A,{modelValue:t(n).propertiesText,"onUpdate:modelValue":e[10]||(e[10]=s=>t(n).propertiesText=s),type:"textarea",rows:4,placeholder:'请输入JSON格式的其他参数，如：{"key": "value"}'},null,8,["modelValue"]),e[20]||(e[20]=C("div",{class:"form-tip"},"扩展属性，JSON格式字符串",-1))]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Pl=be(yl,[["__scopeId","data-v-cf3de5e1"]]);export{Pl as default};
